[{"filePath":"/home/dharwinperez/Code/personal/Website-Kodem-Cards/src/App.tsx","messages":[{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\n/home/dharwinperez/Code/personal/Website-Kodem-Cards/src/App.tsx:120:20\n  118 |                 {/* Todas las demás rutas requieren autenticación */}\n  119 |                 <Route path=\"/admin/cards\">\n> 120 |                   <AuthenticatedRoute>\n      |                    ^^^^^^^^^^^^^^^^^^ This component is created during render\n  121 |                     <CardsManager />\n  122 |                   </AuthenticatedRoute>\n  123 |                 </Route>\n\n/home/dharwinperez/Code/personal/Website-Kodem-Cards/src/App.tsx:81:30\n  79 |\n  80 |   // Componente para rutas que requieren autenticación (todas excepto login y register)\n> 81 |   const AuthenticatedRoute = ({ children }: { children: ReactNode }) => (\n     |                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 82 |     <ProtectedRoute>\n     | ^^^^^^^^^^^^^^^^^^^^\n> 83 |       <PrivateLayout>\n     …\n     | ^^^^^^^^^^^^^^^^^^^^\n> 90 |     </ProtectedRoute>\n     | ^^^^^^^^^^^^^^^^^^^^\n> 91 |   );\n     | ^^^^ The component is created during render here\n  92 |\n  93 |   return (\n  94 |     <Router>","line":120,"column":20,"nodeType":null,"endLine":120,"endColumn":38},{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\n/home/dharwinperez/Code/personal/Website-Kodem-Cards/src/App.tsx:126:20\n  124 |\n  125 |                 <Route path=\"/cards\">\n> 126 |                   <AuthenticatedRoute>\n      |                    ^^^^^^^^^^^^^^^^^^ This component is created during render\n  127 |                     <CardsManager />\n  128 |                   </AuthenticatedRoute>\n  129 |                 </Route>\n\n/home/dharwinperez/Code/personal/Website-Kodem-Cards/src/App.tsx:81:30\n  79 |\n  80 |   // Componente para rutas que requieren autenticación (todas excepto login y register)\n> 81 |   const AuthenticatedRoute = ({ children }: { children: ReactNode }) => (\n     |                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 82 |     <ProtectedRoute>\n     | ^^^^^^^^^^^^^^^^^^^^\n> 83 |       <PrivateLayout>\n     …\n     | ^^^^^^^^^^^^^^^^^^^^\n> 90 |     </ProtectedRoute>\n     | ^^^^^^^^^^^^^^^^^^^^\n> 91 |   );\n     | ^^^^ The component is created during render here\n  92 |\n  93 |   return (\n  94 |     <Router>","line":126,"column":20,"nodeType":null,"endLine":126,"endColumn":38},{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\n/home/dharwinperez/Code/personal/Website-Kodem-Cards/src/App.tsx:132:20\n  130 |\n  131 |                 <Route path=\"/collection\">\n> 132 |                   <AuthenticatedRoute>\n      |                    ^^^^^^^^^^^^^^^^^^ This component is created during render\n  133 |                     <Collection />\n  134 |                   </AuthenticatedRoute>\n  135 |                 </Route>\n\n/home/dharwinperez/Code/personal/Website-Kodem-Cards/src/App.tsx:81:30\n  79 |\n  80 |   // Componente para rutas que requieren autenticación (todas excepto login y register)\n> 81 |   const AuthenticatedRoute = ({ children }: { children: ReactNode }) => (\n     |                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 82 |     <ProtectedRoute>\n     | ^^^^^^^^^^^^^^^^^^^^\n> 83 |       <PrivateLayout>\n     …\n     | ^^^^^^^^^^^^^^^^^^^^\n> 90 |     </ProtectedRoute>\n     | ^^^^^^^^^^^^^^^^^^^^\n> 91 |   );\n     | ^^^^ The component is created during render here\n  92 |\n  93 |   return (\n  94 |     <Router>","line":132,"column":20,"nodeType":null,"endLine":132,"endColumn":38},{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\n/home/dharwinperez/Code/personal/Website-Kodem-Cards/src/App.tsx:139:20\n  137 |                 {/* Rutas para mazos */}\n  138 |                 <Route path=\"/decks\">\n> 139 |                   <AuthenticatedRoute>\n      |                    ^^^^^^^^^^^^^^^^^^ This component is created during render\n  140 |                     <Decks />\n  141 |                   </AuthenticatedRoute>\n  142 |                 </Route>\n\n/home/dharwinperez/Code/personal/Website-Kodem-Cards/src/App.tsx:81:30\n  79 |\n  80 |   // Componente para rutas que requieren autenticación (todas excepto login y register)\n> 81 |   const AuthenticatedRoute = ({ children }: { children: ReactNode }) => (\n     |                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 82 |     <ProtectedRoute>\n     | ^^^^^^^^^^^^^^^^^^^^\n> 83 |       <PrivateLayout>\n     …\n     | ^^^^^^^^^^^^^^^^^^^^\n> 90 |     </ProtectedRoute>\n     | ^^^^^^^^^^^^^^^^^^^^\n> 91 |   );\n     | ^^^^ The component is created during render here\n  92 |\n  93 |   return (\n  94 |     <Router>","line":139,"column":20,"nodeType":null,"endLine":139,"endColumn":38},{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\n/home/dharwinperez/Code/personal/Website-Kodem-Cards/src/App.tsx:153:20\n  151 |\n  152 |                 <Route path=\"/decks/editor\">\n> 153 |                   <AuthenticatedRoute>\n      |                    ^^^^^^^^^^^^^^^^^^ This component is created during render\n  154 |                     <DeckEditor />\n  155 |                   </AuthenticatedRoute>\n  156 |                 </Route>\n\n/home/dharwinperez/Code/personal/Website-Kodem-Cards/src/App.tsx:81:30\n  79 |\n  80 |   // Componente para rutas que requieren autenticación (todas excepto login y register)\n> 81 |   const AuthenticatedRoute = ({ children }: { children: ReactNode }) => (\n     |                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 82 |     <ProtectedRoute>\n     | ^^^^^^^^^^^^^^^^^^^^\n> 83 |       <PrivateLayout>\n     …\n     | ^^^^^^^^^^^^^^^^^^^^\n> 90 |     </ProtectedRoute>\n     | ^^^^^^^^^^^^^^^^^^^^\n> 91 |   );\n     | ^^^^ The component is created during render here\n  92 |\n  93 |   return (\n  94 |     <Router>","line":153,"column":20,"nodeType":null,"endLine":153,"endColumn":38},{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\n/home/dharwinperez/Code/personal/Website-Kodem-Cards/src/App.tsx:159:20\n  157 |\n  158 |                 <Route path=\"/decks/feed\">\n> 159 |                   <AuthenticatedRoute>\n      |                    ^^^^^^^^^^^^^^^^^^ This component is created during render\n  160 |                     <DecksFeed />\n  161 |                   </AuthenticatedRoute>\n  162 |                 </Route>\n\n/home/dharwinperez/Code/personal/Website-Kodem-Cards/src/App.tsx:81:30\n  79 |\n  80 |   // Componente para rutas que requieren autenticación (todas excepto login y register)\n> 81 |   const AuthenticatedRoute = ({ children }: { children: ReactNode }) => (\n     |                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 82 |     <ProtectedRoute>\n     | ^^^^^^^^^^^^^^^^^^^^\n> 83 |       <PrivateLayout>\n     …\n     | ^^^^^^^^^^^^^^^^^^^^\n> 90 |     </ProtectedRoute>\n     | ^^^^^^^^^^^^^^^^^^^^\n> 91 |   );\n     | ^^^^ The component is created during render here\n  92 |\n  93 |   return (\n  94 |     <Router>","line":159,"column":20,"nodeType":null,"endLine":159,"endColumn":38},{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\n/home/dharwinperez/Code/personal/Website-Kodem-Cards/src/App.tsx:173:20\n  171 |\n  172 |                 <Route path=\"/profile\">\n> 173 |                   <AuthenticatedRoute>\n      |                    ^^^^^^^^^^^^^^^^^^ This component is created during render\n  174 |                     <Profile />\n  175 |                   </AuthenticatedRoute>\n  176 |                 </Route>\n\n/home/dharwinperez/Code/personal/Website-Kodem-Cards/src/App.tsx:81:30\n  79 |\n  80 |   // Componente para rutas que requieren autenticación (todas excepto login y register)\n> 81 |   const AuthenticatedRoute = ({ children }: { children: ReactNode }) => (\n     |                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 82 |     <ProtectedRoute>\n     | ^^^^^^^^^^^^^^^^^^^^\n> 83 |       <PrivateLayout>\n     …\n     | ^^^^^^^^^^^^^^^^^^^^\n> 90 |     </ProtectedRoute>\n     | ^^^^^^^^^^^^^^^^^^^^\n> 91 |   );\n     | ^^^^ The component is created during render here\n  92 |\n  93 |   return (\n  94 |     <Router>","line":173,"column":20,"nodeType":null,"endLine":173,"endColumn":38},{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\n/home/dharwinperez/Code/personal/Website-Kodem-Cards/src/App.tsx:179:20\n  177 |\n  178 |                 <Route path=\"/settings\">\n> 179 |                   <AuthenticatedRoute>\n      |                    ^^^^^^^^^^^^^^^^^^ This component is created during render\n  180 |                     <Settings />\n  181 |                   </AuthenticatedRoute>\n  182 |                 </Route>\n\n/home/dharwinperez/Code/personal/Website-Kodem-Cards/src/App.tsx:81:30\n  79 |\n  80 |   // Componente para rutas que requieren autenticación (todas excepto login y register)\n> 81 |   const AuthenticatedRoute = ({ children }: { children: ReactNode }) => (\n     |                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 82 |     <ProtectedRoute>\n     | ^^^^^^^^^^^^^^^^^^^^\n> 83 |       <PrivateLayout>\n     …\n     | ^^^^^^^^^^^^^^^^^^^^\n> 90 |     </ProtectedRoute>\n     | ^^^^^^^^^^^^^^^^^^^^\n> 91 |   );\n     | ^^^^ The component is created during render here\n  92 |\n  93 |   return (\n  94 |     <Router>","line":179,"column":20,"nodeType":null,"endLine":179,"endColumn":38},{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\n/home/dharwinperez/Code/personal/Website-Kodem-Cards/src/App.tsx:186:20\n  184 |                 {/* Ruta principal (ahora es Collection) */}\n  185 |                 <Route path=\"/\">\n> 186 |                   <AuthenticatedRoute>\n      |                    ^^^^^^^^^^^^^^^^^^ This component is created during render\n  187 |                     <Collection />\n  188 |                   </AuthenticatedRoute>\n  189 |                 </Route>\n\n/home/dharwinperez/Code/personal/Website-Kodem-Cards/src/App.tsx:81:30\n  79 |\n  80 |   // Componente para rutas que requieren autenticación (todas excepto login y register)\n> 81 |   const AuthenticatedRoute = ({ children }: { children: ReactNode }) => (\n     |                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 82 |     <ProtectedRoute>\n     | ^^^^^^^^^^^^^^^^^^^^\n> 83 |       <PrivateLayout>\n     …\n     | ^^^^^^^^^^^^^^^^^^^^\n> 90 |     </ProtectedRoute>\n     | ^^^^^^^^^^^^^^^^^^^^\n> 91 |   );\n     | ^^^^ The component is created during render here\n  92 |\n  93 |   return (\n  94 |     <Router>","line":186,"column":20,"nodeType":null,"endLine":186,"endColumn":38},{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\n/home/dharwinperez/Code/personal/Website-Kodem-Cards/src/App.tsx:196:20\n  194 |                 {/* Ruta para selector de cartas */}\n  195 |                 <Route path=\"/cards/selector\">\n> 196 |                   <AuthenticatedRoute>\n      |                    ^^^^^^^^^^^^^^^^^^ This component is created during render\n  197 |                     <CardSelectorPage />\n  198 |                   </AuthenticatedRoute>\n  199 |                 </Route>\n\n/home/dharwinperez/Code/personal/Website-Kodem-Cards/src/App.tsx:81:30\n  79 |\n  80 |   // Componente para rutas que requieren autenticación (todas excepto login y register)\n> 81 |   const AuthenticatedRoute = ({ children }: { children: ReactNode }) => (\n     |                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 82 |     <ProtectedRoute>\n     | ^^^^^^^^^^^^^^^^^^^^\n> 83 |       <PrivateLayout>\n     …\n     | ^^^^^^^^^^^^^^^^^^^^\n> 90 |     </ProtectedRoute>\n     | ^^^^^^^^^^^^^^^^^^^^\n> 91 |   );\n     | ^^^^ The component is created during render here\n  92 |\n  93 |   return (\n  94 |     <Router>","line":196,"column":20,"nodeType":null,"endLine":196,"endColumn":38}],"suppressedMessages":[],"errorCount":10,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Suspense, lazy, ReactNode, useEffect } from 'react';\nimport { Route, Switch, Router } from 'wouter';\nimport { AuthProvider } from '@/context/auth';\nimport { useAuth } from '@/hooks/useAuth';\nimport { SidebarProvider } from '@/context/sidebar';\nimport { QueryProvider } from './lib/QueryProvider';\nimport ProtectedRoute from '@/components/templates/ProtectedRoute';\nimport PrivateLayout from '@/components/templates/PrivateLayout.tsx';\nimport LoadingFallback from '@/components/templates/LoadingFallback.tsx';\nimport { NotFound } from '@/components/templates/NotFound.tsx';\nimport { CollectionProvider } from '@/context/collection';\nimport { WishlistProvider } from '@/context/wishlist';\nimport { UserDataProvider } from '@/context/userData';\nimport { verifyAuthClaims } from '@/lib/firebase';\nimport { GalleryDemo } from './pages/GalleryDemo';\nimport { CardGridDemo } from './pages/CardGridDemo';\n\n// Login y Register son críticos, por lo que los precargamos\nimport Login from '@/pages/Login';\n// Lazy loading con nombres de chunks explícitos para mejor organización\nconst Register = lazy(() => import(/* webpackChunkName: \"auth\" */ '@/pages/Register'));\n\n// Lazy loading agrupado por categorías funcionales para un mejor code splitting\n// Páginas del perfil de usuario\nconst Profile = lazy(() => import(/* webpackChunkName: \"user\" */ '@/pages/Profile'));\nconst Settings = lazy(() => import(/* webpackChunkName: \"user\" */ '@/pages/Settings'));\n\n// Página de colección de cartas\nconst Collection = lazy(() => import(/* webpackChunkName: \"collection\" */ '@/pages/collections'));\n\n// Página de mazos\nconst Decks = lazy(() => import(/* webpackChunkName: \"decks\" */ '@/pages/decks'));\nconst DeckEditor = lazy(() => import(/* webpackChunkName: \"decks\" */ '@/pages/decks/editor'));\nconst DeckDetail = lazy(() => import(/* webpackChunkName: \"decks\" */ '@/pages/decks/[id]'));\nconst DecksFeed = lazy(() => import(/* webpackChunkName: \"decks\" */ '@/pages/decks/feed'));\n\n// Páginas de administración\nconst CardsManager = lazy(() => import(/* webpackChunkName: \"admin\" */ '@/pages/cards/index'));\n\n// Componente para envolver en CollectionProvider y WishlistProvider\nconst WithProviders = ({ children }: { children: ReactNode }) => {\n  const { user } = useAuth();\n\n  // Solo mostrar mensaje de log, evitar refrescar claims para evitar error de logout\n  useEffect(() => {\n    if (user) {\n      console.log('Usuario autenticado en WithProviders:', user.name);\n      console.log('Rol del usuario:', user.role);\n      console.log('Claims en localStorage:', localStorage.getItem('auth_claims'));\n    }\n  }, [user]);\n\n  return (\n    <CollectionProvider>\n      <WishlistProvider>\n        {children}\n      </WishlistProvider>\n    </CollectionProvider>\n  );\n};\n\n// Lazy loading para la página de selector de cartas\nconst CardSelectorPage = lazy(() => import(/* webpackChunkName: \"cards\" */ '@/pages/cards/selector'));\nconst Privacy = lazy(() => import(/* webpackChunkName: \"legal\" */ '@/pages/privacy'));\n\nfunction App() {\n  // Verificar claims de Firebase al cargar la app\n  useEffect(() => {\n    const checkClaims = async () => {\n      try {\n        console.log('Iniciando verificación de claims en App...');\n        await verifyAuthClaims();\n      } catch (error) {\n        console.error('Error al verificar claims en App:', error);\n      }\n    };\n    checkClaims();\n  }, []);\n\n  // Componente para rutas que requieren autenticación (todas excepto login y register)\n  const AuthenticatedRoute = ({ children }: { children: ReactNode }) => (\n    <ProtectedRoute>\n      <PrivateLayout>\n        <WithProviders>\n          <Suspense fallback={<LoadingFallback />}>\n            {children}\n          </Suspense>\n        </WithProviders>\n      </PrivateLayout>\n    </ProtectedRoute>\n  );\n\n  return (\n    <Router>\n      <QueryProvider>\n        <AuthProvider>\n          <UserDataProvider>\n            <SidebarProvider>\n              <Switch>\n                {/* Rutas públicas - solo login y registro */}\n                <Route path=\"/login\">\n                  <Login />\n                </Route>\n\n                <Route path=\"/register\">\n                  <Suspense fallback={<LoadingFallback />}>\n                    <Register />\n                  </Suspense>\n                </Route>\n\n                {/* Página pública de privacidad/términos */}\n                <Route path=\"/privacy\">\n                  <Suspense fallback={<LoadingFallback />}>\n                    <Privacy />\n                  </Suspense>\n                </Route>\n\n                {/* Todas las demás rutas requieren autenticación */}\n                <Route path=\"/admin/cards\">\n                  <AuthenticatedRoute>\n                    <CardsManager />\n                  </AuthenticatedRoute>\n                </Route>\n\n                <Route path=\"/cards\">\n                  <AuthenticatedRoute>\n                    <CardsManager />\n                  </AuthenticatedRoute>\n                </Route>\n\n                <Route path=\"/collection\">\n                  <AuthenticatedRoute>\n                    <Collection />\n                  </AuthenticatedRoute>\n                </Route>\n\n                {/* Rutas para mazos */}\n                <Route path=\"/decks\">\n                  <AuthenticatedRoute>\n                    <Decks />\n                  </AuthenticatedRoute>\n                </Route>\n\n                <Route path=\"/decks/editor/:id\">\n                  {() => (\n                    <AuthenticatedRoute>\n                      <DeckEditor />\n                    </AuthenticatedRoute>\n                  )}\n                </Route>\n\n                <Route path=\"/decks/editor\">\n                  <AuthenticatedRoute>\n                    <DeckEditor />\n                  </AuthenticatedRoute>\n                </Route>\n\n                <Route path=\"/decks/feed\">\n                  <AuthenticatedRoute>\n                    <DecksFeed />\n                  </AuthenticatedRoute>\n                </Route>\n\n                <Route path=\"/decks/:id\">\n                  {() => (\n                    <AuthenticatedRoute>\n                      <DeckDetail />\n                    </AuthenticatedRoute>\n                  )}\n                </Route>\n\n                <Route path=\"/profile\">\n                  <AuthenticatedRoute>\n                    <Profile />\n                  </AuthenticatedRoute>\n                </Route>\n\n                <Route path=\"/settings\">\n                  <AuthenticatedRoute>\n                    <Settings />\n                  </AuthenticatedRoute>\n                </Route>\n\n                {/* Ruta principal (ahora es Collection) */}\n                <Route path=\"/\">\n                  <AuthenticatedRoute>\n                    <Collection />\n                  </AuthenticatedRoute>\n                </Route>\n\n                <Route path=\"/gallery-demo\" component={GalleryDemo} />\n                <Route path=\"/card-grid-demo\" component={CardGridDemo} />\n\n                {/* Ruta para selector de cartas */}\n                <Route path=\"/cards/selector\">\n                  <AuthenticatedRoute>\n                    <CardSelectorPage />\n                  </AuthenticatedRoute>\n                </Route>\n\n                {/* Ruta para capturar todas las URLs no definidas (404) y mostrar página no encontrada */}\n                <Route path=\"/:rest*\">\n                  <Suspense fallback={<LoadingFallback />}>\n                    <NotFound />\n                  </Suspense>\n                </Route>\n              </Switch>\n            </SidebarProvider>\n          </UserDataProvider>\n        </AuthProvider>\n      </QueryProvider>\n    </Router>\n  );\n}\n\nexport default App;\n","usedDeprecatedRules":[]},{"filePath":"/home/dharwinperez/Code/personal/Website-Kodem-Cards/src/components/atoms/CollectionStats.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n/home/dharwinperez/Code/personal/Website-Kodem-Cards/src/components/atoms/CollectionStats.tsx:21:9\n  19 |     useEffect(() => {\n  20 |         console.log('CollectionStats - Props recibidas:', { collected, total });\n> 21 |         setStats({ collected, total });\n     |         ^^^^^^^^ Avoid calling setState() directly within an effect\n  22 |     }, [collected, total]);\n  23 |\n  24 |     const percentage = stats.total > 0 ? Math.round((stats.collected / stats.total) * 100) : 0;","line":21,"column":9,"nodeType":null,"endLine":21,"endColumn":17}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from 'react';\nimport { Badge } from '@/components/atoms/Badge';\nimport { cn } from '@/lib/utils';\n\ninterface CollectionStatsProps {\n    collected: number;\n    total: number;\n    className?: string;\n}\n\n/**\n * CollectionStats - Componente para mostrar estadísticas de colección\n */\nexport function CollectionStats({ collected, total, className }: CollectionStatsProps) {\n    // Usar estado local para asegurar que los valores se actualicen correctamente\n    const [stats, setStats] = useState({ collected: 0, total: 0 });\n\n    // Actualizar el estado cuando cambian las props\n    useEffect(() => {\n        console.log('CollectionStats - Props recibidas:', { collected, total });\n        setStats({ collected, total });\n    }, [collected, total]);\n\n    const percentage = stats.total > 0 ? Math.round((stats.collected / stats.total) * 100) : 0;\n\n    return (\n        <Badge\n            variant=\"secondary\"\n            className={cn(\n                \"text-xs font-medium py-0.5 px-1.5 sm:px-2\",\n                className\n            )}\n            title={`${percentage}% completado`}\n        >\n            {stats.collected}/{stats.total}\n        </Badge>\n    );\n}\n\nexport default CollectionStats; ","usedDeprecatedRules":[]},{"filePath":"/home/dharwinperez/Code/personal/Website-Kodem-Cards/src/components/atoms/OptimizedImage.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n/home/dharwinperez/Code/personal/Website-Kodem-Cards/src/components/atoms/OptimizedImage.tsx:37:9\n  35 |     // Reiniciar estado cuando cambia la URL fuente\n  36 |     useEffect(() => {\n> 37 |         setIsLoading(true);\n     |         ^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  38 |         setError(false);\n  39 |         setCurrentSrc(src);\n  40 |     }, [src]);","line":37,"column":9,"nodeType":null,"endLine":37,"endColumn":21}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, memo } from 'react';\nimport { Skeleton } from '@/components/atoms/Skeleton';\nimport { cn } from '@/lib/utils';\n\ninterface OptimizedImageProps extends React.ImgHTMLAttributes<HTMLImageElement> {\n    src: string;\n    alt: string;\n    fallbackSrc?: string;\n    width?: number;\n    height?: number;\n    className?: string;\n    skeletonClassName?: string;\n    eager?: boolean; // Cargar inmediatamente sin lazy loading\n}\n\n/**\n * OptimizedImage - Componente para mostrar imágenes optimizadas con lazy loading,\n * fallbacks, y placeholders durante la carga\n */\nconst OptimizedImage = ({\n    src,\n    alt,\n    fallbackSrc = '/placeholder-image.png',\n    width,\n    height,\n    className,\n    skeletonClassName,\n    eager = false,\n    ...props\n}: OptimizedImageProps) => {\n    const [isLoading, setIsLoading] = useState(true);\n    const [error, setError] = useState(false);\n    const [currentSrc, setCurrentSrc] = useState(src);\n\n    // Reiniciar estado cuando cambia la URL fuente\n    useEffect(() => {\n        setIsLoading(true);\n        setError(false);\n        setCurrentSrc(src);\n    }, [src]);\n\n    // Convertir a WebP si es posible\n    const getWebPUrl = (url: string): string => {\n        // Solo convertir si no es una URL de WebP ya\n        if (url.includes('.webp')) return url;\n\n        // Validación segura de Cloudinary usando el objeto URL\n        try {\n            const parsedUrl = new URL(url);\n            if (parsedUrl.host === 'res.cloudinary.com' && !url.includes('/f_webp/')) {\n                return url.replace(/\\/upload\\//, '/upload/f_webp/');\n            }\n        } catch (e) {\n            // Si no es una URL válida, continuar con la lógica anterior\n        }\n\n        // Si es un archivo local, buscar versión webp\n        if (url.match(/\\.(jpe?g|png)$/i)) {\n            return url.replace(/\\.(jpe?g|png)$/i, '.webp');\n        }\n\n        return url;\n    };\n\n    // Intentar usar WebP si es compatible\n    const webpUrl = getWebPUrl(currentSrc);\n\n    const handleImageLoad = () => {\n        setIsLoading(false);\n    };\n\n    const handleImageError = () => {\n        setIsLoading(false);\n\n        // Si falla con WebP, intentar con la URL original\n        if (webpUrl !== currentSrc) {\n            setCurrentSrc(src);\n            return;\n        }\n\n        // Si falla la URL original, usar el fallback\n        if (currentSrc !== fallbackSrc) {\n            setError(true);\n            setCurrentSrc(fallbackSrc);\n        }\n    };\n\n    return (\n        <div className={cn(\"relative\", className)} style={{ width, height }}>\n            {isLoading && (\n                <Skeleton className={cn(\"absolute inset-0 z-10\", skeletonClassName)} />\n            )}\n\n            <picture>\n                {/* Formatos modernos para navegadores compatibles */}\n                <source srcSet={webpUrl} type=\"image/webp\" />\n\n                <img\n                    src={currentSrc}\n                    alt={alt}\n                    className={cn(\n                        \"transition-opacity duration-300 w-full h-full object-cover\",\n                        isLoading ? \"opacity-0\" : \"opacity-100\",\n                        error ? \"grayscale opacity-70\" : \"\"\n                    )}\n                    loading={eager ? \"eager\" : \"lazy\"}\n                    onLoad={handleImageLoad}\n                    onError={handleImageError}\n                    width={width}\n                    height={height}\n                    {...props}\n                />\n            </picture>\n        </div>\n    );\n};\n\nexport default memo(OptimizedImage); ","usedDeprecatedRules":[]},{"filePath":"/home/dharwinperez/Code/personal/Website-Kodem-Cards/src/components/molecules/ThemeSwitcher.tsx","messages":[{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`applyTheme` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\n/home/dharwinperez/Code/personal/Website-Kodem-Cards/src/components/molecules/ThemeSwitcher.tsx:68:17\n  66 |             if (storedTheme) {\n  67 |                 setTheme(storedTheme);\n> 68 |                 applyTheme(storedTheme);\n     |                 ^^^^^^^^^^ `applyTheme` accessed before it is declared\n  69 |             } else {\n  70 |                 // Detectar tema del sistema\n  71 |                 const systemTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';\n\n/home/dharwinperez/Code/personal/Website-Kodem-Cards/src/components/molecules/ThemeSwitcher.tsx:79:5\n  77 |\n  78 |     // Función para aplicar el tema al documento\n> 79 |     const applyTheme = (newTheme: Theme) => {\n     |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 80 |         const root = window.document.documentElement;\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 81 |         const systemTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';\n     …\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 91 |         }\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 92 |     };\n     | ^^^^^^^ `applyTheme` is declared here\n  93 |\n  94 |     // Función para cambiar el tema\n  95 |     const changeTheme = (newTheme: Theme) => {","line":68,"column":17,"nodeType":null,"endLine":68,"endColumn":27}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from 'react';\nimport { Moon, Sun, Monitor } from 'lucide-react';\nimport { Button } from '@/components/atoms/Button';\nimport {\n    DropdownMenu,\n    DropdownMenuContent,\n    DropdownMenuItem,\n    DropdownMenuTrigger,\n} from '@/components/atoms/DropdownMenu';\nimport { cn } from '@/lib/utils';\n\nexport type Theme = 'light' | 'dark' | 'system';\n\nexport interface ThemeSwitcherProps {\n    /**\n     * Tema actual seleccionado\n     */\n    theme?: Theme;\n\n    /**\n     * Función llamada al cambiar el tema\n     */\n    onThemeChange?: (theme: Theme) => void;\n\n    /**\n     * Clases adicionales para el componente\n     */\n    className?: string;\n\n    /**\n     * Si es true, muestra un botón más pequeño sin texto\n     */\n    compact?: boolean;\n\n    /**\n     * Alineación del menú desplegable\n     */\n    align?: 'start' | 'center' | 'end';\n}\n\n/**\n * ThemeSwitcher - Componente para cambiar entre temas claro, oscuro y sistema\n */\nexport function ThemeSwitcher({\n    theme: controlledTheme,\n    onThemeChange,\n    className,\n    compact = false,\n    align = 'end'\n}: ThemeSwitcherProps) {\n    const [theme, setTheme] = useState<Theme>('system');\n\n    // Sincronizar con el tema controlado si se proporciona\n    useEffect(() => {\n        if (controlledTheme) {\n            setTheme(controlledTheme);\n        }\n    }, [controlledTheme]);\n\n    // Si no hay un tema controlado, detectar el tema del sistema\n    useEffect(() => {\n        if (!controlledTheme) {\n            // Obtener tema del localStorage\n            const storedTheme = localStorage.getItem('theme') as Theme;\n\n            if (storedTheme) {\n                setTheme(storedTheme);\n                applyTheme(storedTheme);\n            } else {\n                // Detectar tema del sistema\n                const systemTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';\n                setTheme('system');\n                applyTheme(systemTheme);\n            }\n        }\n    }, [controlledTheme]);\n\n    // Función para aplicar el tema al documento\n    const applyTheme = (newTheme: Theme) => {\n        const root = window.document.documentElement;\n        const systemTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';\n\n        // Eliminar clases antiguas\n        root.classList.remove('light', 'dark');\n\n        // Aplicar la clase según el tema seleccionado\n        if (newTheme === 'system') {\n            root.classList.add(systemTheme);\n        } else {\n            root.classList.add(newTheme);\n        }\n    };\n\n    // Función para cambiar el tema\n    const changeTheme = (newTheme: Theme) => {\n        if (onThemeChange) {\n            // Componente controlado\n            onThemeChange(newTheme);\n        } else {\n            // Componente no controlado\n            setTheme(newTheme);\n            localStorage.setItem('theme', newTheme);\n\n            if (newTheme === 'system') {\n                const systemTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';\n                applyTheme(systemTheme);\n            } else {\n                applyTheme(newTheme);\n            }\n        }\n    };\n\n    // Escuchar cambios en el tema del sistema si está en modo \"system\"\n    useEffect(() => {\n        if (theme === 'system') {\n            const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');\n\n            const handleChange = () => {\n                if (theme === 'system') {\n                    applyTheme('system');\n                }\n            };\n\n            mediaQuery.addEventListener('change', handleChange);\n            return () => mediaQuery.removeEventListener('change', handleChange);\n        }\n    }, [theme]);\n\n    // Renderizar icono según el tema actual\n    const renderIcon = () => {\n        switch (theme) {\n            case 'light':\n                return <Sun className=\"h-4 w-4\" />;\n            case 'dark':\n                return <Moon className=\"h-4 w-4\" />;\n            case 'system':\n                return <Monitor className=\"h-4 w-4\" />;\n            default:\n                return <Sun className=\"h-4 w-4\" />;\n        }\n    };\n\n    // Obtener etiqueta de texto según el tema\n    const getThemeLabel = (themeValue: Theme): string => {\n        switch (themeValue) {\n            case 'light':\n                return 'Claro';\n            case 'dark':\n                return 'Oscuro';\n            case 'system':\n                return 'Sistema';\n            default:\n                return 'Desconocido';\n        }\n    };\n\n    return (\n        <DropdownMenu>\n            <DropdownMenuTrigger asChild>\n                <Button\n                    variant=\"primary\"\n                    size={compact ? \"sm\" : \"md\"}\n                    className={cn(\n                        \"gap-2\",\n                        compact ? \"w-9 px-0\" : \"px-3\",\n                        className\n                    )}\n                    aria-label=\"Cambiar tema\"\n                >\n                    {renderIcon()}\n                    {!compact && <span>{getThemeLabel(theme)}</span>}\n                </Button>\n            </DropdownMenuTrigger>\n            <DropdownMenuContent align={align}>\n                <DropdownMenuItem onClick={() => changeTheme('light')}>\n                    <Sun className=\"mr-2 h-4 w-4\" />\n                    <span>Claro</span>\n                </DropdownMenuItem>\n                <DropdownMenuItem onClick={() => changeTheme('dark')}>\n                    <Moon className=\"mr-2 h-4 w-4\" />\n                    <span>Oscuro</span>\n                </DropdownMenuItem>\n                <DropdownMenuItem onClick={() => changeTheme('system')}>\n                    <Monitor className=\"mr-2 h-4 w-4\" />\n                    <span>Sistema</span>\n                </DropdownMenuItem>\n            </DropdownMenuContent>\n        </DropdownMenu>\n    );\n} ","usedDeprecatedRules":[]},{"filePath":"/home/dharwinperez/Code/personal/Website-Kodem-Cards/src/components/organisms/CollectionFilters.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n/home/dharwinperez/Code/personal/Website-Kodem-Cards/src/components/organisms/CollectionFilters.tsx:48:13\n  46 |         \n  47 |         if (storedTypeAvailability !== null) {\n> 48 |             setHaveTypeData(storedTypeAvailability === 'true');\n     |             ^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  49 |         }\n  50 |         \n  51 |         if (storedEnergyAvailability !== null) {","line":48,"column":13,"nodeType":null,"endLine":48,"endColumn":28}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from 'react';\nimport { XMarkIcon, MagnifyingGlassIcon, ExclamationTriangleIcon } from '@heroicons/react/24/outline';\nimport { Button } from '@/components/atoms/Button';\nimport { Checkbox } from '@/components/atoms/Checkbox';\nimport { Label } from '@/components/atoms/Label';\nimport { Input } from '@/components/atoms/Input';\nimport { FilterItem } from '@/components/molecules/FilterItem';\nimport { CardType, CardEnergy, CardRarity } from '@/types/card';\n\nexport interface CollectionFiltersState {\n    searchTerm: string;\n    typeFilter: CardType | 'all_types';\n    energyFilter: CardEnergy | 'all_energies';\n    rarityFilter: CardRarity | 'all_rarities';\n    showOnlyMissing: boolean;\n    showOnlyCollected: boolean;\n}\n\ninterface CollectionFiltersProps {\n    filters: CollectionFiltersState;\n    onFiltersChange: (filters: Partial<CollectionFiltersState>) => void;\n    onClearFilters: () => void;\n}\n\nexport const CollectionFilters: React.FC<CollectionFiltersProps> = ({\n    filters,\n    onFiltersChange,\n    onClearFilters,\n}) => {\n    const { searchTerm, typeFilter, energyFilter, rarityFilter, showOnlyMissing, showOnlyCollected } = filters;\n    \n    // Estados para controlar la disponibilidad de datos\n    const [haveTypeData, setHaveTypeData] = useState<boolean>(true);\n    const [haveEnergyData, setHaveEnergyData] = useState<boolean>(true);\n\n    // Depuración - Inspeccionar los valores de CardType y CardEnergy para verificar que son correctos\n    useEffect(() => {\n        console.log('Valores disponibles de CardType:', Object.values(CardType));\n        console.log('Valores disponibles de CardEnergy:', Object.values(CardEnergy));\n        console.log('Valores disponibles de CardRarity:', Object.values(CardRarity));\n        \n        // Intentar determinar la disponibilidad de datos basados en la depuración de la consola\n        // Esto debería sincronizarse automáticamente con el estado en useCollectionFilters\n        const storedTypeAvailability = localStorage.getItem('haveTypeData');\n        const storedEnergyAvailability = localStorage.getItem('haveEnergyData');\n        \n        if (storedTypeAvailability !== null) {\n            setHaveTypeData(storedTypeAvailability === 'true');\n        }\n        \n        if (storedEnergyAvailability !== null) {\n            setHaveEnergyData(storedEnergyAvailability === 'true');\n        }\n    }, []);\n\n    // Comprobar si hay algún filtro activo\n    const hasActiveFilters =\n        searchTerm !== '' ||\n        typeFilter !== 'all_types' ||\n        energyFilter !== 'all_energies' ||\n        rarityFilter !== 'all_rarities' ||\n        showOnlyMissing ||\n        showOnlyCollected;\n\n    // Manejadores de cambio para cada filtro\n    const handleSearchChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n        onFiltersChange({ searchTerm: e.target.value });\n    };\n\n    const handleTypeFilterChange = (value: string) => {\n        console.log('Cambiando tipo de carta a:', value);\n        \n        // Caso especial para ROT - asegurarse de que sea exactamente \"rot\"\n        if (value.toLowerCase() === 'rot') {\n            console.log('¡ROT seleccionado! - Aplicando tratamiento especial');\n            // Asegurarse de que el valor sea exactamente \"rot\" del enum CardType\n            const rotEnumValue = Object.values(CardType).find(\n                type => type.toLowerCase() === 'rot'\n            );\n            \n            if (rotEnumValue) {\n                console.log('Valor ROT del enum encontrado:', rotEnumValue);\n                onFiltersChange({ typeFilter: rotEnumValue as CardType });\n                return;\n            }\n        }\n        \n        // Asegurarse de que el valor sea convertido correctamente al tipo esperado\n        const newTypeFilter = value as CardType | 'all_types';\n        onFiltersChange({ typeFilter: newTypeFilter });\n    };\n\n    const handleEnergyFilterChange = (value: string) => {\n        onFiltersChange({ energyFilter: value as CardEnergy | 'all_energies' });\n    };\n\n    const handleRarityFilterChange = (value: string) => {\n        onFiltersChange({ rarityFilter: value as CardRarity | 'all_rarities' });\n    };\n\n    const handleShowOnlyMissingChange = (checked: boolean) => {\n        onFiltersChange({ showOnlyMissing: checked });\n    };\n    \n    const handleShowOnlyCollectedChange = (checked: boolean) => {\n        onFiltersChange({ showOnlyCollected: checked });\n    };\n\n    return (\n        <div className=\"py-2 px-3 sm:p-4 bg-background\">\n            {/* Barra de búsqueda - ahora más accesible */}\n            <div className=\"relative mb-3\">\n                <MagnifyingGlassIcon className=\"absolute left-2 top-3 h-4 w-4 text-muted-foreground pointer-events-none\" />\n                <Input\n                    type=\"text\"\n                    placeholder=\"Buscar por nombre o ID...\"\n                    value={searchTerm}\n                    onChange={handleSearchChange}\n                    className=\"pl-8 w-full h-10 sm:h-9 text-sm\"\n                />\n                <div className=\"text-xs text-muted-foreground mt-1 ml-1\">\n                    Busca por nombre de carta o por ID (ej. IDRMP-001)\n                </div>\n            </div>\n\n            {/* Botón limpiar filtros - visible solo cuando hay filtros activos */}\n            {hasActiveFilters && (\n                <div className=\"mb-3\">\n                    <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={onClearFilters}\n                        className=\"w-full justify-center h-9 text-xs flex items-center gap-1\"\n                    >\n                        <XMarkIcon className=\"h-4 w-4\" />\n                        Limpiar filtros\n                    </Button>\n                </div>\n            )}\n\n            {/* Mensaje de advertencia si faltan datos de tipo o energía */}\n            {(!haveTypeData || !haveEnergyData) && (\n                <div className=\"mb-3 p-2 bg-yellow-100 border border-yellow-300 rounded-md flex items-start gap-2 text-yellow-800\">\n                    <ExclamationTriangleIcon className=\"h-5 w-5 flex-shrink-0 mt-0.5\" />\n                    <div className=\"text-xs\">\n                        <p className=\"font-medium\">Advertencia: Datos inconsistentes</p>\n                        <p>Se han detectado inconsistencias en los datos de las cartas. Algunos filtros podrían no funcionar correctamente.</p>\n                    </div>\n                </div>\n            )}\n\n            {/* Filtros: en columna para móvil, en fila para desktop */}\n            <div className=\"block sm:hidden space-y-3\">\n                {/* Filtro de tipo - móvil */}\n                <FilterItem\n                    label=\"Tipo de carta\"\n                    value={typeFilter}\n                    onChange={handleTypeFilterChange}\n                    options={[\n                        { value: 'all_types', label: 'Todos los tipos' },\n                        ...Object.values(CardType).map(type => ({\n                            value: type,\n                            label: type.charAt(0).toUpperCase() + type.slice(1)\n                        }))\n                    ]}\n                    mobileOptimized={true}\n                    disabled={!haveTypeData}\n                />\n                \n                {/* Filtro de energía - móvil */}\n                <FilterItem\n                    label=\"Energía\"\n                    value={energyFilter}\n                    onChange={handleEnergyFilterChange}\n                    options={[\n                        { value: 'all_energies', label: 'Todas las energías' },\n                        ...Object.values(CardEnergy).map(energy => ({\n                            value: energy,\n                            label: energy.charAt(0).toUpperCase() + energy.slice(1)\n                        }))\n                    ]}\n                    mobileOptimized={true}\n                    disabled={!haveEnergyData}\n                />\n                \n                {/* Filtro de rareza - móvil */}\n                <FilterItem\n                    label=\"Rareza\"\n                    value={rarityFilter}\n                    onChange={handleRarityFilterChange}\n                    options={[\n                        { value: 'all_rarities', label: 'Todas las rarezas' },\n                        ...Object.values(CardRarity).map(rarity => ({\n                            value: rarity,\n                            label: rarity.charAt(0).toUpperCase() + rarity.slice(1)\n                        }))\n                    ]}\n                    mobileOptimized={true}\n                />\n            </div>\n\n            {/* Filtros en fila horizontal para desktop */}\n            <div className=\"hidden sm:grid grid-cols-3 gap-3 mb-3\">\n                {/* Filtro de tipo de carta - desktop */}\n                <FilterItem\n                    label=\"Tipo de carta\"\n                    value={typeFilter}\n                    onChange={(value) => {\n                        console.log('Tipo de carta seleccionado:', value);\n                        // Tratamiento especial para ROT - hardcodeado por ser problemático\n                        if (value.toLowerCase() === 'rot') {\n                            console.log('¡ROT seleccionado! - Aplicando tratamiento especial');\n                        }\n                        handleTypeFilterChange(value);\n                    }}\n                    options={[\n                        { value: 'all_types', label: 'Todos los tipos' },\n                        // Opción explícita para 'rot' que es problemático\n                        { value: 'rot', label: 'Rot' },\n                        ...Object.values(CardType)\n                            .filter(type => type.toLowerCase() !== 'rot') // Excluimos rot para evitar duplicados\n                            .map(type => ({\n                                value: type,\n                                label: type.charAt(0).toUpperCase() + type.slice(1)\n                            }))\n                    ]}\n                    disabled={!haveTypeData}\n                />\n                \n                {/* Filtro de energía - desktop */}\n                <FilterItem\n                    label=\"Energía\"\n                    value={energyFilter}\n                    onChange={(value) => {\n                        console.log('Energía seleccionada:', value);\n                        handleEnergyFilterChange(value);\n                    }}\n                    options={[\n                        { value: 'all_energies', label: 'Todas las energías' },\n                        ...Object.values(CardEnergy).map(energy => ({\n                            value: energy,\n                            label: energy.charAt(0).toUpperCase() + energy.slice(1)\n                        }))\n                    ]}\n                    disabled={!haveEnergyData}\n                />\n                \n                {/* Filtro de rareza - desktop */}\n                <FilterItem\n                    label=\"Rareza\"\n                    value={rarityFilter}\n                    onChange={handleRarityFilterChange}\n                    options={[\n                        { value: 'all_rarities', label: 'Todas las rarezas' },\n                        ...Object.values(CardRarity).map(rarity => ({\n                            value: rarity,\n                            label: rarity.charAt(0).toUpperCase() + rarity.slice(1)\n                        }))\n                    ]}\n                />\n            </div>\n            \n            {/* Filtros de checkbox */}\n            <div className=\"space-y-2 mt-3\">\n                {/* Checkbox para cartas faltantes */}\n                <div className=\"flex items-center space-x-2 bg-muted/30 p-2 rounded-md\">\n                    <Checkbox\n                        id=\"showOnlyMissing\"\n                        checked={showOnlyMissing}\n                        onCheckedChange={checked => handleShowOnlyMissingChange(checked === true)}\n                        className=\"h-5 w-5\"\n                        disabled={showOnlyCollected}\n                    />\n                    <Label htmlFor=\"showOnlyMissing\" className=\"text-sm cursor-pointer flex-1\">\n                        Mostrar solo cartas faltantes\n                    </Label>\n                </div>\n                \n                {/* Checkbox para cartas en la colección */}\n                <div className=\"flex items-center space-x-2 bg-muted/30 p-2 rounded-md\">\n                    <Checkbox\n                        id=\"showOnlyCollected\"\n                        checked={showOnlyCollected}\n                        onCheckedChange={checked => handleShowOnlyCollectedChange(checked === true)}\n                        className=\"h-5 w-5\"\n                        disabled={showOnlyMissing}\n                    />\n                    <Label htmlFor=\"showOnlyCollected\" className=\"text-sm cursor-pointer flex-1\">\n                        Mostrar solo cartas en la colección\n                    </Label>\n                </div>\n            </div>\n        </div>\n    );\n}; ","usedDeprecatedRules":[]},{"filePath":"/home/dharwinperez/Code/personal/Website-Kodem-Cards/src/components/organisms/CollectionGrid.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n/home/dharwinperez/Code/personal/Website-Kodem-Cards/src/components/organisms/CollectionGrid.tsx:62:13\n  60 |     useEffect(() => {\n  61 |         if (expandAllSignal !== null) {\n> 62 |             setIsExpanded(expandAllSignal);\n     |             ^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  63 |         }\n  64 |     }, [expandAllSignal]);\n  65 |","line":62,"column":13,"nodeType":null,"endLine":62,"endColumn":26},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n/home/dharwinperez/Code/personal/Website-Kodem-Cards/src/components/organisms/CollectionGrid.tsx:74:13\n  72 |     useEffect(() => {\n  73 |         if (isExpanded) {\n> 74 |             setItemsToShow(50); // Valor inicial cuando se expande\n     |             ^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  75 |         }\n  76 |     }, [isExpanded]);\n  77 |","line":74,"column":13,"nodeType":null,"endLine":74,"endColumn":27},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n/home/dharwinperez/Code/personal/Website-Kodem-Cards/src/components/organisms/CollectionGrid.tsx:136:17\n  134 |             if (updatedCard && updatedCard.mainCard.quantity !== selectedCard.mainCard.quantity) {\n  135 |                 // Actualizar el estado con la nueva versión de la carta\n> 136 |                 setSelectedCard(updatedCard);\n      |                 ^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  137 |             }\n  138 |         }\n  139 |     }, [sortedCards, selectedCard, updatingCardId]);","line":136,"column":17,"nodeType":null,"endLine":136,"endColumn":32}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { memo, useState, useEffect, useMemo, useCallback } from 'react';\nimport { Card, CardContent } from '@/components/atoms/Card';\nimport { CardWithQuantity } from '@/types/collection';\nimport { cn } from '@/lib/utils';\nimport {\n    Dialog,\n    DialogContent,\n    DialogHeader,\n    DialogTitle\n} from '@/components/atoms/Dialog';\nimport { Button } from '@/components/atoms/Button';\nimport { Badge } from '@/components/atoms/Badge';\nimport { Separator } from '@/components/atoms/Separator';\nimport { Heart, Plus, Check } from 'lucide-react';\nimport { useWishlist } from '@/hooks/useWishlist';\nimport { WishListPriority, AddToWishListRequest } from '@/types/wishlist';\nimport {\n    DropdownMenu,\n    DropdownMenuContent,\n    DropdownMenuItem,\n    DropdownMenuLabel,\n    DropdownMenuSeparator,\n    DropdownMenuTrigger,\n} from '@/components/atoms/DropdownMenu';\nimport { TooltipProvider, Tooltip, TooltipTrigger, TooltipContent } from '@/components/atoms/Tooltip';\n\ninterface CollectionGridProps {\n    cards: CardWithQuantity[];\n    cardsByRarity: Record<string, CardWithQuantity[]>;\n    updateCardQuantity: (cardId: string, quantity: number) => void;\n    updatingCardId: string | null;\n    className?: string;\n}\n\n// Componente para una sección de rareza, optimizado con memo\nconst RaritySection = memo(({\n    rarity,\n    cards,\n    updateCardQuantity,\n    updatingCardId,\n    expandAllSignal\n}: {\n    rarity: string;\n    cards: CardWithQuantity[];\n    updateCardQuantity: (cardId: string, quantity: number) => void;\n    updatingCardId: string | null;\n    expandAllSignal: boolean | null;\n}) => {\n    // Estado para el modal\n    const [selectedCard, setSelectedCard] = useState<CardWithQuantity | null>(null);\n    const [isModalOpen, setIsModalOpen] = useState(false);\n    // Estado para el índice de la carta seleccionada\n    const [selectedCardIndex, setSelectedCardIndex] = useState<number>(-1);\n    // Estado para expandir/contraer la sección - por defecto contraída\n    const [isExpanded, setIsExpanded] = useState(false);\n    // Estado para controlar la carga progresiva de cartas\n    const [itemsToShow, setItemsToShow] = useState(50);\n\n    // Escuchar el signal de expandir/contraer todas las secciones\n    useEffect(() => {\n        if (expandAllSignal !== null) {\n            setIsExpanded(expandAllSignal);\n        }\n    }, [expandAllSignal]);\n\n    // Ordenar las cartas por número de carta\n    const sortedCards = useMemo(() => {\n        return [...cards].sort((a, b) => (a.mainCard.cardNumber || 0) - (b.mainCard.cardNumber || 0));\n    }, [cards]);\n\n    // Resetear itemsToShow cuando cambie la expansión\n    useEffect(() => {\n        if (isExpanded) {\n            setItemsToShow(50); // Valor inicial cuando se expande\n        }\n    }, [isExpanded]);\n\n    // Función para cargar más cartas cuando se hace scroll\n    const handleLoadMore = useCallback(() => {\n        if (isExpanded && itemsToShow < sortedCards.length) {\n            setItemsToShow(prev => Math.min(prev + 50, sortedCards.length));\n        }\n    }, [isExpanded, itemsToShow, sortedCards.length]);\n\n    // Función para abrir el modal con la carta seleccionada\n    const handleCardClick = (card: CardWithQuantity) => {\n        const index = sortedCards.findIndex(c => c.mainCard.id === card.mainCard.id);\n        setSelectedCardIndex(index);\n        setSelectedCard(card);\n        setIsModalOpen(true);\n    };\n\n    // Función para navegar a la carta anterior\n    const handlePrevCard = useCallback(() => {\n        if (selectedCardIndex > 0) {\n            const prevIndex = selectedCardIndex - 1;\n            setSelectedCardIndex(prevIndex);\n            setSelectedCard(sortedCards[prevIndex]);\n        }\n    }, [selectedCardIndex, sortedCards]);\n\n    // Función para navegar a la carta siguiente\n    const handleNextCard = useCallback(() => {\n        if (selectedCardIndex < sortedCards.length - 1) {\n            const nextIndex = selectedCardIndex + 1;\n            setSelectedCardIndex(nextIndex);\n            setSelectedCard(sortedCards[nextIndex]);\n        }\n    }, [selectedCardIndex, sortedCards]);\n    \n    // Controlar la navegación con teclado\n    useEffect(() => {\n        if (!isModalOpen) return;\n        \n        const handleKeyDown = (e: KeyboardEvent) => {\n            if (e.key === 'Escape') {\n                setIsModalOpen(false);\n            } else if (e.key === 'ArrowLeft') {\n                handlePrevCard();\n            } else if (e.key === 'ArrowRight') {\n                handleNextCard();\n            }\n        };\n        \n        window.addEventListener('keydown', handleKeyDown);\n        return () => window.removeEventListener('keydown', handleKeyDown);\n    }, [isModalOpen, handlePrevCard, handleNextCard]);\n\n    // Actualizar la carta seleccionada cuando cambie su cantidad\n    useEffect(() => {\n        if (selectedCard && !updatingCardId) {\n            // Buscar la versión actualizada de la carta en el array de cartas\n            const updatedCard = sortedCards.find(card => card.mainCard.id === selectedCard.mainCard.id);\n            if (updatedCard && updatedCard.mainCard.quantity !== selectedCard.mainCard.quantity) {\n                // Actualizar el estado con la nueva versión de la carta\n                setSelectedCard(updatedCard);\n            }\n        }\n    }, [sortedCards, selectedCard, updatingCardId]);\n\n    // Función para manejar la actualización desde el modal\n    const handleUpdateQuantity = (cardId: string, quantity: number) => {\n        updateCardQuantity(cardId, quantity);\n        \n        // Actualizar también la carta seleccionada localmente para feedback inmediato\n        if (selectedCard && selectedCard.mainCard.id === cardId) {\n            setSelectedCard({\n                ...selectedCard,\n                mainCard: {\n                    ...selectedCard.mainCard,\n                    quantity: quantity,\n                    inCollection: quantity > 0\n                }\n            });\n        }\n    };\n\n    // Función para capitalizar la primera letra de un string\n    const capitalize = (text: string) => {\n        return text.charAt(0).toUpperCase() + text.slice(1);\n    };\n    \n    // Calcular estadísticas de esta rareza\n    const totalCards = sortedCards.length;\n    const collectedCards = sortedCards.filter(card => card.mainCard.quantity > 0).length;\n    const collectionPercentage = totalCards > 0 ? Math.round((collectedCards / totalCards) * 100) : 0;\n\n    return (\n        <div key={rarity} className=\"space-y-2 mb-4\">\n            {/* Cabecera con el botón para expandir/contraer */}\n            <button\n                className=\"w-full flex items-center justify-between border-b pb-1 hover:bg-muted/20 transition-colors rounded px-2\"\n                onClick={() => setIsExpanded(!isExpanded)}\n                aria-expanded={isExpanded}\n                aria-controls={`rarity-cards-${rarity}`}\n            >\n                <h3 className=\"text-sm font-medium capitalize flex items-center gap-2\">\n                    <span>{capitalize(rarity)}</span>\n                    <Badge variant=\"outline\" className=\"text-xs\">\n                        {collectedCards}/{totalCards}\n                    </Badge>\n                </h3>\n                <div className=\"flex items-center gap-2\">\n                    <span className=\"text-xs text-muted-foreground\">{collectionPercentage}% completado</span>\n                    <svg \n                        xmlns=\"http://www.w3.org/2000/svg\" \n                        width=\"16\" \n                        height=\"16\" \n                        viewBox=\"0 0 24 24\" \n                        fill=\"none\" \n                        stroke=\"currentColor\" \n                        strokeWidth=\"2\" \n                        strokeLinecap=\"round\" \n                        strokeLinejoin=\"round\" \n                        className={`transition-transform ${isExpanded ? \"rotate-180\" : \"\"}`}\n                    >\n                        <polyline points=\"6 9 12 15 18 9\"/>\n                    </svg>\n                </div>\n            </button>\n\n            {/* Contenido de la sección (visible solo cuando está expandida) */}\n            <div \n                id={`rarity-cards-${rarity}`}\n                className={`transition-opacity duration-300 overflow-hidden ${\n                    isExpanded \n                        ? \"opacity-100 max-h-full\"\n                        : \"opacity-0 max-h-0\"\n                }`}\n            >\n                <div className=\"grid grid-cols-2 xs:grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3 sm:gap-3 md:gap-4 auto-rows-[min-content]\">\n                    {sortedCards.slice(0, itemsToShow).map((cardGroup) => (\n                        <CardItem\n                            key={cardGroup.mainCard.id}\n                            cardGroup={cardGroup}\n                            updateCardQuantity={updateCardQuantity}\n                            updatingCardId={updatingCardId}\n                            onCardClick={handleCardClick}\n                        />\n                    ))}\n                </div>\n                \n                {/* Trigger para cargar más cartas */}\n                {isExpanded && sortedCards.length > itemsToShow && (\n                    <div \n                        id={`load-more-${rarity}`} \n                        className=\"py-4 text-center text-sm text-muted-foreground\"\n                        onClick={handleLoadMore}\n                    >\n                        Cargando más cartas...\n                    </div>\n                )}\n            </div>\n\n            {/* Modal para ver detalles de la carta con navegación */}\n            <Dialog open={isModalOpen} onOpenChange={setIsModalOpen}>\n                <DialogContent className=\"bg-white p-3 sm:p-5 overflow-x-hidden overflow-y-auto \n                    w-[92vw] sm:w-[470px] pb-16 sm:pb-5 max-h-[90vh] sm:max-h-[650px] flex flex-col modal-mobile-height\">\n                    {/* Botones de navegación (solo desktop) */}\n                    {selectedCardIndex > 0 && (\n                        <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            className=\"absolute left-0 top-1/2 -translate-y-1/2 -translate-x-1/2 h-12 w-12 rounded-full shadow-lg bg-white border-2 border-primary/30 hover:bg-primary/10 z-[100] opacity-95 hover:opacity-100 hidden sm:flex items-center justify-center\"\n                            onClick={handlePrevCard}\n                            aria-label=\"Carta anterior\"\n                        >\n                            <svg\n                                xmlns=\"http://www.w3.org/2000/svg\"\n                                width=\"24\"\n                                height=\"24\"\n                                viewBox=\"0 0 24 24\"\n                                fill=\"none\"\n                                stroke=\"currentColor\"\n                                strokeWidth=\"2.5\"\n                                strokeLinecap=\"round\"\n                                strokeLinejoin=\"round\"\n                                className=\"text-primary\"\n                            >\n                                <path d=\"M15 18l-6-6 6-6\" />\n                            </svg>\n                        </Button>\n                    )}\n                    \n                    {selectedCardIndex < sortedCards.length - 1 && (\n                        <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            className=\"absolute right-0 top-1/2 -translate-y-1/2 translate-x-1/2 h-12 w-12 rounded-full shadow-lg bg-white border-2 border-primary/30 hover:bg-primary/10 z-[100] opacity-95 hover:opacity-100 hidden sm:flex items-center justify-center\"\n                            onClick={handleNextCard}\n                            aria-label=\"Carta siguiente\"\n                        >\n                            <svg\n                                xmlns=\"http://www.w3.org/2000/svg\"\n                                width=\"24\"\n                                height=\"24\"\n                                viewBox=\"0 0 24 24\"\n                                fill=\"none\"\n                                stroke=\"currentColor\"\n                                strokeWidth=\"2.5\"\n                                strokeLinecap=\"round\"\n                                strokeLinejoin=\"round\"\n                                className=\"text-primary\"\n                            >\n                                <path d=\"M9 18l6-6-6-6\" />\n                            </svg>\n                        </Button>\n                    )}\n                    \n                    {/* Bottom Navigation Bar (solo mobile) */}\n                    <div className=\"fixed bottom-0 left-0 right-0 h-16 bg-white border-t border-gray-200 flex items-center justify-around px-4 sm:hidden z-[100] shadow-[0_-2px_10px_rgba(0,0,0,0.05)]\">\n                        {/* Botón Anterior */}\n                        <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            className={cn(\n                              \"flex flex-col items-center gap-0.5 h-auto py-1 px-6\",\n                              selectedCardIndex <= 0 ? \"opacity-50 pointer-events-none text-gray-400\" : \"text-primary\"\n                            )}\n                            onClick={handlePrevCard}\n                            disabled={selectedCardIndex <= 0}\n                        >\n                            <svg\n                                xmlns=\"http://www.w3.org/2000/svg\"\n                                width=\"20\"\n                                height=\"20\"\n                                viewBox=\"0 0 24 24\"\n                                fill=\"none\"\n                                stroke=\"currentColor\"\n                                strokeWidth=\"2\"\n                                strokeLinecap=\"round\"\n                                strokeLinejoin=\"round\"\n                                className=\"mb-0.5\"\n                            >\n                                <path d=\"M15 18l-6-6 6-6\" />\n                            </svg>\n                            <span className=\"text-xs font-medium\">Anterior</span>\n                        </Button>\n                        \n                        {/* Indicador de posición */}\n                        <div className=\"bg-gray-100 px-3 py-1 rounded-full flex items-center justify-center\">\n                            <span className=\"text-xs font-medium\">\n                                {selectedCardIndex + 1} / {sortedCards.length}\n                            </span>\n                        </div>\n                        \n                        {/* Botón Siguiente */}\n                        <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            className={cn(\n                              \"flex flex-col items-center gap-0.5 h-auto py-1 px-6\",\n                              selectedCardIndex >= sortedCards.length - 1 ? \"opacity-50 pointer-events-none text-gray-400\" : \"text-primary\"\n                            )}\n                            onClick={handleNextCard}\n                            disabled={selectedCardIndex >= sortedCards.length - 1}\n                        >\n                            <svg\n                                xmlns=\"http://www.w3.org/2000/svg\"\n                                width=\"20\"\n                                height=\"20\"\n                                viewBox=\"0 0 24 24\"\n                                fill=\"none\"\n                                stroke=\"currentColor\"\n                                strokeWidth=\"2\"\n                                strokeLinecap=\"round\"\n                                strokeLinejoin=\"round\"\n                                className=\"mb-0.5\"\n                            >\n                                <path d=\"M9 18l6-6-6-6\" />\n                            </svg>\n                            <span className=\"text-xs font-medium\">Siguiente</span>\n                        </Button>\n                    </div>\n                    \n                    {/* Contenido del modal */}\n                    {selectedCard && (\n                        <div className=\"flex flex-col w-full max-w-full\">\n                            <DialogHeader className=\"mb-2 sm:mb-4\">\n                                <DialogTitle className=\"text-base sm:text-xl text-center text-black truncate\">{selectedCard.mainCard.name}</DialogTitle>\n                                <div className=\"flex justify-center gap-2 mt-1 flex-wrap\">\n                                    {selectedCard.mainCard.rarity && (\n                                        <Badge variant=\"outline\" className=\"capitalize text-xs text-black border-black/20\">\n                                            {selectedCard.mainCard.rarity}\n                                        </Badge>\n                                    )}\n                                    {selectedCard.mainCard.type && (\n                                        <Badge variant=\"outline\" className=\"capitalize text-xs text-black border-black/20\">\n                                            {selectedCard.mainCard.type}\n                                        </Badge>\n                                    )}\n                                </div>\n                                \n                                {/* Indicador de posición (solo desktop) */}\n                                <div className=\"text-xs text-muted-foreground text-center mt-1 hidden sm:flex items-center justify-center gap-2\">\n                                    <span>Carta {selectedCardIndex + 1} de {sortedCards.length}</span>\n                                </div>\n                            </DialogHeader>\n\n                            {/* Contenedor principal con scroll */}\n                            <div className=\"flex flex-col overflow-y-auto flex-grow custom-scrollbar max-h-[calc(90vh-140px)] sm:max-h-none\">\n                                {/* Imagen con altura adaptativa */}\n                                <div className=\"mb-2 mx-auto flex-shrink-0 modal-image-container\">\n                                    <Card className=\"overflow-hidden border-none shadow-md sm:w-[280px] mx-auto\">\n                                        <CardContent className=\"p-0\">\n                                            {selectedCard.mainCard.imageUrl ? (\n                                                <img\n                                                    src={selectedCard.mainCard.imageUrl}\n                                                    alt={selectedCard.mainCard.name}\n                                                    className=\"w-full object-contain max-h-[40vh] sm:max-h-[420px]\"\n                                                    loading=\"lazy\"\n                                                />\n                                            ) : (\n                                                <div className=\"w-full aspect-[2/3] bg-muted flex items-center justify-center max-h-[40vh] sm:max-h-[420px]\">\n                                                    <span className=\"text-muted-foreground\">Sin imagen</span>\n                                                </div>\n                                            )}\n                                        </CardContent>\n                                    </Card>\n                                </div>\n\n                                <Separator className=\"my-2 sm:my-3 bg-black/10\" />\n\n                                {/* Información detallada - altura flexible */}\n                                <div className=\"space-y-2 sm:space-y-3 overflow-y-auto\">\n                                    {/* Información detallada */}\n                                    <div className=\"grid grid-cols-2 gap-x-4 gap-y-2 text-xs sm:text-sm text-black max-w-full overflow-hidden\">\n                                        {selectedCard.mainCard.cardNumber !== undefined && (\n                                            <div className=\"flex justify-between\">\n                                                <span className=\"font-medium\">Número:</span>\n                                                <span>#{selectedCard.mainCard.cardNumber}</span>\n                                            </div>\n                                        )}\n                                        {selectedCard.mainCard.cardSet && (\n                                            <div className=\"flex justify-between\">\n                                                <span className=\"font-medium\">Set:</span>\n                                                <span className=\"capitalize truncate ml-1\">{selectedCard.mainCard.cardSet}</span>\n                                            </div>\n                                        )}\n                                        {selectedCard.mainCard.energy && (\n                                            <div className=\"flex justify-between\">\n                                                <span className=\"font-medium\">Energía:</span>\n                                                <span className=\"capitalize\">{selectedCard.mainCard.energy}</span>\n                                            </div>\n                                        )}\n                                        {selectedCard.mainCard.power !== undefined && (\n                                            <div className=\"flex justify-between\">\n                                                <span className=\"font-medium\">Daño:</span>\n                                                <span>{selectedCard.mainCard.power}</span>\n                                            </div>\n                                        )}\n                                        {selectedCard.mainCard.sleep !== undefined && (\n                                            <div className=\"flex justify-between\">\n                                                <span className=\"font-medium\">Descanso:</span>\n                                                <span>{selectedCard.mainCard.sleep}</span>\n                                            </div>\n                                        )}\n                                    </div>\n\n                                    {/* Descripción */}\n                                    {selectedCard.mainCard.description && (\n                                        <Card className=\"bg-muted/20 max-w-full overflow-hidden\">\n                                            <CardContent className=\"p-2 sm:p-3\">\n                                                <p className=\"text-xs sm:text-sm italic text-black break-words\">{selectedCard.mainCard.description}</p>\n                                            </CardContent>\n                                        </Card>\n                                    )}\n\n                                    {/* Reglas - colapsables en móvil */}\n                                    {selectedCard.mainCard.rules && selectedCard.mainCard.rules.length > 0 && (\n                                        <details className=\"text-xs sm:text-sm text-black max-w-full overflow-hidden\">\n                                            <summary className=\"font-medium cursor-pointer p-1\">\n                                                Reglas ({selectedCard.mainCard.rules.length})\n                                            </summary>\n                                            <ul className=\"list-disc list-inside space-y-1 mt-1 pl-2 break-words\">\n                                                {selectedCard.mainCard.rules.map((rule, index) => (\n                                                    <li key={index} className=\"break-words\">{rule}</li>\n                                                ))}\n                                            </ul>\n                                        </details>\n                                    )}\n\n                                    {/* Artista */}\n                                    {selectedCard.mainCard.artist && selectedCard.mainCard.artist.length > 0 && (\n                                        <div className=\"text-xs text-right truncate\">\n                                            <span className=\"text-black/60\">Ilustrado por: {selectedCard.mainCard.artist.join(', ')}</span>\n                                        </div>\n                                    )}\n                                </div>\n                            </div>\n\n                            <Separator className=\"my-2 sm:my-3 bg-black/10\" />\n\n                            {/* Controles de cantidad */}\n                            <div className=\"flex justify-center items-center gap-2 sm:gap-3 max-w-full mt-auto pt-2\">\n                                <span className=\"text-xs sm:text-sm text-black\">Cantidad:</span>\n                                <div className=\"flex items-center\">\n                                    <Button\n                                        size=\"sm\"\n                                        variant=\"outline\"\n                                        className=\"h-8 w-8 rounded-r-none text-black border-black/20\"\n                                        disabled={updatingCardId === selectedCard.mainCard.id || selectedCard.mainCard.quantity <= 0}\n                                        onClick={() => handleUpdateQuantity(selectedCard.mainCard.id, Math.max(0, selectedCard.mainCard.quantity - 1))}\n                                    >\n                                        -\n                                    </Button>\n                                    <span className={cn(\n                                        \"inline-flex h-8 min-w-[2rem] items-center justify-center text-sm border-y px-2 border-black/20\",\n                                        selectedCard.mainCard.quantity > 0\n                                            ? \"bg-green-50 text-green-900 border-green-200\"\n                                            : \"bg-muted text-black\"\n                                    )}>\n                                        {selectedCard.mainCard.quantity}\n                                    </span>\n                                    <Button\n                                        size=\"sm\"\n                                        variant=\"outline\"\n                                        className=\"h-8 w-8 rounded-l-none text-black border-black/20\"\n                                        disabled={updatingCardId === selectedCard.mainCard.id}\n                                        onClick={() => handleUpdateQuantity(selectedCard.mainCard.id, selectedCard.mainCard.quantity + 1)}\n                                    >\n                                        +\n                                    </Button>\n                                </div>\n                            </div>\n                        </div>\n                    )}\n                </DialogContent>\n            </Dialog>\n        </div>\n    );\n});\n\nRaritySection.displayName = 'RaritySection';\n\ninterface CardItemProps {\n    cardGroup: CardWithQuantity;\n    updateCardQuantity: (cardId: string, quantity: number) => void;\n    updatingCardId: string | null;\n    onCardClick: (card: CardWithQuantity) => void;\n}\n\n// Componente para una carta individual\nconst CardItem = memo(({\n    cardGroup,\n    updateCardQuantity,\n    updatingCardId,\n    onCardClick\n}: CardItemProps) => {\n    const card = cardGroup.mainCard;\n    const isUpdating = updatingCardId === card.id;\n    \n    // Acceder al contexto de listas de deseos\n    const { \n        userWishlists, \n        isCardInWishlists, \n        addCardToWishlist, \n        removeCardFromWishlist \n    } = useWishlist();\n    \n    // Comprobar si la carta está en alguna lista\n    const { inWishlist, wishlists } = isCardInWishlists(card.id);\n    \n    // Manejar clic en la carta\n    const handleCardClick = () => {\n        onCardClick(cardGroup);\n    };\n    \n    // Incrementar cantidad de carta\n    const handleIncrement = (e: React.MouseEvent) => {\n        e.stopPropagation();\n        if (!isUpdating) {\n            updateCardQuantity(card.id, card.quantity + 1);\n        }\n    };\n    \n    // Decrementar cantidad de carta\n    const handleDecrement = (e: React.MouseEvent) => {\n        e.stopPropagation();\n        if (!isUpdating && card.quantity > 0) {\n            updateCardQuantity(card.id, card.quantity - 1);\n        }\n    };\n    \n    // Agregar a lista de deseos\n    const handleAddToWishlist = async (wishlistId: string, e: React.MouseEvent) => {\n        e.stopPropagation();\n        \n        const request: AddToWishListRequest = {\n            wishlistId,\n            cardId: card.id,\n            priority: WishListPriority.MEDIUM\n        };\n        \n        try {\n            await addCardToWishlist(request);\n        } catch (error) {\n            console.error('Error al agregar carta a la lista de deseos:', error);\n        }\n    };\n    \n    // Eliminar de una lista de deseos\n    const handleRemoveFromWishlist = async (wishlistId: string, e: React.MouseEvent) => {\n        e.stopPropagation();\n        \n        try {\n            await removeCardFromWishlist(wishlistId, card.id);\n        } catch (error) {\n            console.error('Error al eliminar carta de la lista de deseos:', error);\n        }\n    };\n    \n    // Evitar la propagación del clic al menú\n    const handleMenuClick = (e: React.MouseEvent) => {\n        e.stopPropagation();\n    };\n    \n    return (\n        <div className=\"relative h-full\">\n            <div\n                onClick={handleCardClick}\n                className={cn(\n                    \"w-full h-full text-left border rounded-lg overflow-hidden shadow-sm group cursor-pointer\",\n                    \"transition-all duration-200 ease-in-out\",\n                    card.inCollection ? \"bg-white\" : \"bg-muted/30\",\n                    \"flex flex-col\"\n                )}\n                role=\"button\"\n                tabIndex={0}\n                aria-disabled={isUpdating}\n                onKeyDown={(e) => {\n                    if (e.key === 'Enter' || e.key === ' ') {\n                        e.preventDefault();\n                        handleCardClick();\n                    }\n                }}\n            >\n                {/* Superposición de carga durante actualización */}\n                {isUpdating && (\n                    <div className=\"absolute inset-0 bg-black/20 z-10 flex items-center justify-center rounded-lg\">\n                        <div className=\"w-5 h-5 border-2 border-primary border-t-transparent rounded-full animate-spin\"></div>\n                    </div>\n                )}\n                \n                {/* Imagen de la carta */}\n                <div className=\"relative aspect-[2/3] bg-black/5 overflow-hidden\">\n                    <div className=\"absolute inset-0 flex items-center justify-center\">\n                        <img\n                            src={card.imageUrl || '/images/card-back.png'}\n                            alt={card.name}\n                            className=\"object-contain w-full h-full\"\n                            loading=\"lazy\"\n                        />\n                    </div>\n                    \n                    {/* Etiquetas en la esquina */}\n                    <div className=\"absolute top-2 right-2 flex flex-col items-end gap-1.5\">\n                        {/* Etiqueta de rareza */}\n                        {card.rarity && (\n                            <Badge\n                                variant=\"secondary\"\n                                className=\"bg-black/70 text-white text-xs py-1 px-2 capitalize pointer-events-none\"\n                            >\n                                {card.rarity}\n                            </Badge>\n                        )}\n                        \n                        {/* Indicador de lista de deseos */}\n                        {inWishlist && (\n                            <Badge\n                                variant=\"secondary\"\n                                className=\"bg-primary/80 text-white text-xs py-1 px-2 pointer-events-none\"\n                            >\n                                <Heart size={12} className=\"mr-1\" />\n                                Deseada\n                            </Badge>\n                        )}\n                    </div>\n                </div>\n                \n                {/* Información mínima de la carta */}\n                <div className=\"p-3 text-sm text-left flex-grow flex flex-col justify-between bg-gradient-to-b from-transparent to-muted/10\">\n                    <p className=\"font-medium truncate mb-1.5 leading-tight\" title={card.name}>\n                        {card.name}\n                    </p>\n                    \n                    <div className=\"flex items-center justify-between mt-auto\">\n                        {/* Energia si aplica */}\n                        {card.energy && (\n                            <span className=\"text-xs text-muted-foreground capitalize truncate\">\n                                {card.energy}\n                            </span>\n                        )}\n                        \n                        {/* Controles de cantidad */}\n                        <div className=\"ml-auto flex items-center gap-1.5\">\n                            <button\n                                onClick={handleDecrement}\n                                className={cn(\n                                    \"w-7 h-7 flex items-center justify-center rounded-full text-xs border\",\n                                    \"transition-colors\",\n                                    card.quantity > 0\n                                        ? \"bg-white text-primary border-primary hover:bg-primary/10 active:bg-primary/20 pointer-events-auto\"\n                                        : \"bg-muted text-muted-foreground cursor-not-allowed pointer-events-none\"\n                                )}\n                                disabled={isUpdating || card.quantity <= 0}\n                                aria-label=\"Disminuir cantidad\"\n                            >\n                                -\n                            </button>\n                            \n                            <Badge \n                                variant={card.quantity > 0 ? \"secondary\" : \"outline\"}\n                                className={cn(\n                                    \"text-xs py-0.5 px-2 h-auto min-w-[1.5rem] flex items-center justify-center\",\n                                    card.quantity > 0 \n                                        ? \"bg-primary/10 text-primary\" \n                                        : \"border-muted-foreground/30 text-muted-foreground\"\n                                )}\n                            >\n                                {card.quantity}\n                            </Badge>\n                            \n                            <button\n                                onClick={handleIncrement}\n                                className={cn(\n                                    \"w-7 h-7 flex items-center justify-center rounded-full text-xs border\",\n                                    \"pointer-events-auto bg-white text-primary border-primary\",\n                                    \"hover:bg-primary/10 active:bg-primary/20 transition-colors\"\n                                )}\n                                disabled={isUpdating}\n                                aria-label=\"Aumentar cantidad\"\n                            >\n                                +\n                            </button>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            \n            {/* Botón flotante para agregar a lista de deseos */}\n            <TooltipProvider>\n                <Tooltip>\n                    <TooltipTrigger asChild>\n                        <div className=\"absolute bottom-2 left-2 z-20\">\n                            <DropdownMenu>\n                                <DropdownMenuTrigger asChild onClick={handleMenuClick}>\n                                    <Button\n                                        variant=\"secondary\"\n                                        size=\"sm\"\n                                        className=\"h-9 w-9 rounded-full shadow-md bg-white hover:bg-white hover:text-primary\"\n                                    >\n                                        <Heart\n                                            size={18}\n                                            className={inWishlist ? \"fill-primary text-red-500\" : \"text-red-500\"}\n                                        />\n                                    </Button>\n                                </DropdownMenuTrigger>\n                                <DropdownMenuContent align=\"start\" className=\"w-56 bg-white\">\n                                    <DropdownMenuLabel>Añadir a lista de deseos</DropdownMenuLabel>\n                                    <DropdownMenuSeparator />\n                                    \n                                    {userWishlists.length === 0 ? (\n                                        <div className=\"px-2 py-1.5 text-sm text-muted-foreground\">\n                                            No tienes listas de deseos. Crea una en la sección de Listas.\n                                        </div>\n                                    ) : (\n                                        userWishlists.map(list => {\n                                            const isInList = wishlists.includes(list.id);\n                                            return (\n                                                <DropdownMenuItem\n                                                    key={list.id}\n                                                    className=\"flex items-center justify-between cursor-pointer\"\n                                                    onClick={isInList\n                                                        ? (e) => handleRemoveFromWishlist(list.id, e)\n                                                        : (e) => handleAddToWishlist(list.id, e)\n                                                    }\n                                                >\n                                                    <span>{list.name}</span>\n                                                    {isInList ? (\n                                                        <Check size={16} className=\"text-primary\" />\n                                                    ) : (\n                                                        <Plus size={16} />\n                                                    )}\n                                                </DropdownMenuItem>\n                                            );\n                                        })\n                                    )}\n                                </DropdownMenuContent>\n                            </DropdownMenu>\n                        </div>\n                    </TooltipTrigger>\n                    <TooltipContent className=\"bg-white\">\n                        Lista de deseos\n                    </TooltipContent>\n                </Tooltip>\n            </TooltipProvider>\n        </div>\n    );\n});\n\nCardItem.displayName = 'CardItem';\n\n/**\n * CollectionGrid - Componente para mostrar una cuadrícula de cartas de colección\n */\nexport const CollectionGrid = memo(function CollectionGrid({\n    cards,\n    cardsByRarity,\n    updateCardQuantity,\n    updatingCardId,\n    className\n}: Omit<CollectionGridProps, 'title'>) {\n    // Estado para expandir/contraer todas las secciones\n    const [allExpanded, setAllExpanded] = useState(false);\n    \n    // Ordenar rarezas por orden lógico: de más rara a menos rara\n    const getSortedRarities = (): string[] => {\n        // Definir orden de rarezas (ajustar según necesidades)\n        const rarityOrder = ['mythic', 'ultra_rare', 'rare', 'uncommon', 'common'];\n\n        // Obtener todas las rarezas disponibles\n        const availableRarities = Object.keys(cardsByRarity);\n\n        // Ordenar basado en el orden definido\n        return availableRarities.sort((a, b) => {\n            const indexA = rarityOrder.indexOf(a);\n            const indexB = rarityOrder.indexOf(b);\n\n            // Si ambos existen en el orden predefinido\n            if (indexA !== -1 && indexB !== -1) {\n                return indexA - indexB;\n            }\n\n            // Si solo uno existe, priorizarlo\n            if (indexA !== -1) return -1;\n            if (indexB !== -1) return 1;\n\n            // Si ninguno existe en el orden predefinido, orden alfabético\n            return a.localeCompare(b);\n        });\n    };\n\n    // Obtener rarezas ordenadas\n    const sortedRarities = getSortedRarities();\n    \n    // Calcular estadísticas de colección\n    const totalCards = cards.length;\n    const collectedCards = cards.filter(card => card.mainCard.quantity > 0).length;\n    const collectionPercentage = totalCards > 0 ? Math.round((collectedCards / totalCards) * 100) : 0;\n\n    // Referencia al evento personalizado para expandir/contraer secciones\n    const [expandAll, setExpandAll] = useState<boolean | null>(null);\n\n    // Función para expandir o contraer todas las secciones\n    const toggleAllSections = () => {\n        const newExpandState = !allExpanded;\n        setAllExpanded(newExpandState);\n        setExpandAll(newExpandState);\n    };\n\n    return (\n        <div className={cn(\"space-y-4\", className)}>\n            {cards.length === 0 ? (\n                <div className=\"p-4 sm:p-6 text-center rounded-lg border border-border bg-card\">\n                    <h3 className=\"text-base sm:text-lg font-medium mb-2\">No hay cartas para mostrar</h3>\n                    <p className=\"text-sm text-muted-foreground\">\n                        Ajusta los filtros o selecciona otro set\n                    </p>\n                </div>\n            ) : (\n                <>\n                    {/* Contador total de cartas */}\n                    <div className=\"flex items-center justify-between p-2 sm:p-3 bg-muted rounded-lg border border-border\">\n                        <div className=\"flex flex-col sm:flex-row sm:items-center sm:gap-2\">\n                            <h3 className=\"text-sm font-medium\">Total cartas: {totalCards}</h3>\n                            <div className=\"flex items-center gap-1 text-xs text-muted-foreground\">\n                                <span>Coleccionadas: {collectedCards}</span>\n                                <Badge variant=\"outline\" className=\"bg-primary/10 text-primary\">\n                                    {collectionPercentage}%\n                                </Badge>\n                            </div>\n                        </div>\n                        \n                        {/* Botón para expandir/contraer todas las secciones */}\n                        <Button \n                            variant=\"outline\" \n                            size=\"sm\" \n                            onClick={toggleAllSections}\n                            className=\"text-xs h-8\"\n                        >\n                            {allExpanded ? \"Contraer todo\" : \"Expandir todo\"}\n                            <svg \n                                xmlns=\"http://www.w3.org/2000/svg\" \n                                width=\"14\" \n                                height=\"14\" \n                                viewBox=\"0 0 24 24\" \n                                fill=\"none\" \n                                stroke=\"currentColor\" \n                                strokeWidth=\"2\" \n                                strokeLinecap=\"round\" \n                                strokeLinejoin=\"round\" \n                                className={`ml-1 transition-transform ${allExpanded ? \"rotate-180\" : \"\"}`}\n                            >\n                                <polyline points=\"6 9 12 15 18 9\"/>\n                            </svg>\n                        </Button>\n                    </div>\n                    \n                    {/* Mostrar secciones por rareza */}\n                    {sortedRarities.map((rarity) => (\n                        <RaritySection\n                            key={rarity}\n                            rarity={rarity}\n                            cards={cardsByRarity[rarity] || []}\n                            updateCardQuantity={updateCardQuantity}\n                            updatingCardId={updatingCardId}\n                            expandAllSignal={expandAll}\n                        />\n                    ))}\n                </>\n            )}\n        </div>\n    );\n});\n\nexport default CollectionGrid; ","usedDeprecatedRules":[]},{"filePath":"/home/dharwinperez/Code/personal/Website-Kodem-Cards/src/pages/wishlist/[id].tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n/home/dharwinperez/Code/personal/Website-Kodem-Cards/src/pages/wishlist/[id].tsx:106:13\n  104 |     useEffect(() => {\n  105 |         if (wishlist) {\n> 106 |             setListDetails({\n      |             ^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  107 |                 name: wishlist.name,\n  108 |                 description: wishlist.description || ''\n  109 |             });","line":106,"column":13,"nodeType":null,"endLine":106,"endColumn":27},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n/home/dharwinperez/Code/personal/Website-Kodem-Cards/src/pages/wishlist/[id].tsx:687:9\n  685 |     // Resetear visibleCount cuando cambian las cartas\n  686 |     useEffect(() => {\n> 687 |         setVisibleCount(20);\n      |         ^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  688 |     }, [cards]);\n  689 |\n  690 |     // Scroll infinito con IntersectionObserver","line":687,"column":9,"nodeType":null,"endLine":687,"endColumn":24}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState, useRef } from 'react';\nimport { useLocation } from 'wouter';\nimport { useAuth } from '@/hooks/useAuth';\nimport { useWishlist } from '@/hooks/useWishlist';\nimport { Spinner } from '@/components/atoms/Spinner';\nimport { EmptyState } from '@/components/molecules/EmptyState';\nimport { Button } from '@/components/atoms/Button';\nimport { Edit, ArrowLeft, Trash, Copy, Check, X, Printer } from 'lucide-react';\nimport { EnrichedWishListCard, WishList } from '@/types/wishlist';\nimport { Textarea } from '@/components/atoms/Textarea';\nimport { Input } from '@/components/atoms/Input';\nimport { Label } from '@/components/atoms/Label';\nimport { Image } from '@/components/atoms/Image';\nimport {\n    Select,\n    SelectContent,\n    SelectItem,\n    SelectTrigger,\n    SelectValue\n} from '@/components/atoms/Select';\nimport { toast } from 'sonner';\n\n// Custom Hooks\nfunction useWishlistData(id: string) {\n    const [isLoading, setIsLoading] = useState(true);\n    const [cards, setCards] = useState<EnrichedWishListCard[]>([]);\n    const {\n        selectedWishlist,\n        selectWishlist,\n        getEnrichedCards,\n        updateWishlist,\n        removeCardFromWishlist,\n        loading,\n    } = useWishlist();\n    const navigate = useLocation()[1];\n\n    // Cargar la lista específica cuando cambie el ID\n    useEffect(() => {\n        const loadWishlist = async () => {\n            if (!id) return;\n\n            setIsLoading(true);\n            try {\n                await selectWishlist(id);\n            } catch (error) {\n                console.error('Error al cargar la lista:', error);\n                navigate('/wishlists');\n            } finally {\n                setIsLoading(false);\n            }\n        };\n\n        loadWishlist();\n    }, [id, selectWishlist, navigate]);\n\n    // Cargar las cartas de la lista\n    useEffect(() => {\n        const loadCards = async () => {\n            if (!id) return;\n\n            try {\n                const enrichedCards = await getEnrichedCards(id);\n                setCards(enrichedCards);\n            } catch (error) {\n                console.error('Error al cargar las cartas:', error);\n            }\n        };\n\n        loadCards();\n    }, [id, getEnrichedCards]);\n\n    // Eliminar carta de la lista\n    const handleRemoveCard = async (cardId: string) => {\n        if (!selectedWishlist) return;\n\n        if (window.confirm('¿Estás seguro de que deseas eliminar esta carta de la lista?')) {\n            try {\n                await removeCardFromWishlist(selectedWishlist.id, cardId);\n                // Actualizar la lista local de cartas\n                setCards(prev => prev.filter(card => card.wishlistData.cardId !== cardId));\n            } catch (error) {\n                console.error('Error al eliminar la carta:', error);\n            }\n        }\n    };\n\n    return {\n        isLoading: isLoading || loading,\n        cards,\n        selectedWishlist,\n        updateWishlist,\n        handleRemoveCard\n    };\n}\n\nfunction useWishlistDetails(wishlist: WishList | null) {\n    const [isEditingDetails, setIsEditingDetails] = useState(false);\n    const [listDetails, setListDetails] = useState({\n        name: '',\n        description: ''\n    });\n\n    // Actualizar los detalles cuando cambie la wishlist\n    useEffect(() => {\n        if (wishlist) {\n            setListDetails({\n                name: wishlist.name,\n                description: wishlist.description || ''\n            });\n        }\n    }, [wishlist]);\n\n    // Manejar cambios en los detalles\n    const handleDetailsChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {\n        const { name, value } = e.target;\n        setListDetails(prev => ({\n            ...prev,\n            [name]: value\n        }));\n    };\n\n    return {\n        isEditingDetails,\n        setIsEditingDetails,\n        listDetails,\n        handleDetailsChange\n    };\n}\n\nfunction useFullscreenViewer() {\n    const [fullscreenImage, setFullscreenImage] = useState<string | null>(null);\n    const [fullscreenCardName, setFullscreenCardName] = useState<string>('');\n    const [fullscreenSetName, setFullscreenSetName] = useState<string>('');\n    const [fullscreenFullId, setFullscreenFullId] = useState<string>('');\n    const [fullscreenRarity, setFullscreenRarity] = useState<string>('');\n\n    // Cerrar visor a pantalla completa\n    const handleCloseFullscreen = () => {\n        setFullscreenImage(null);\n        setFullscreenCardName('');\n        setFullscreenSetName('');\n        setFullscreenFullId('');\n        setFullscreenRarity('');\n    };\n\n    // Bloquear scroll cuando está en pantalla completa\n    useEffect(() => {\n        if (fullscreenImage) {\n            document.body.style.overflow = 'hidden';\n\n            // Añadir event listener para la tecla ESC\n            const handleEscKeyPress = (event: KeyboardEvent) => {\n                if (event.key === 'Escape') {\n                    handleCloseFullscreen();\n                }\n            };\n\n            // Agregar el event listener al document\n            document.addEventListener('keydown', handleEscKeyPress);\n\n            // Limpiar event listener al desmontar\n            return () => {\n                document.body.style.overflow = '';\n                document.removeEventListener('keydown', handleEscKeyPress);\n            };\n        } else {\n            document.body.style.overflow = '';\n\n            return () => {\n                document.body.style.overflow = '';\n            };\n        }\n    }, [fullscreenImage]);\n\n    // Abrir visor a pantalla completa\n    const handleOpenFullscreen = (imageUrl: string | undefined, card: EnrichedWishListCard) => {\n        if (imageUrl) {\n            setFullscreenImage(imageUrl);\n            setFullscreenCardName(card.cardDetails.name);\n            setFullscreenSetName(card.cardDetails.setName || card.cardDetails.cardSet || '');\n            setFullscreenFullId(card.cardDetails.fullId || '');\n            setFullscreenRarity(card.cardDetails.rarity || '');\n        }\n    };\n\n    return {\n        fullscreenImage,\n        fullscreenCardName,\n        fullscreenSetName,\n        fullscreenFullId,\n        fullscreenRarity,\n        handleOpenFullscreen,\n        handleCloseFullscreen\n    };\n}\n\nfunction useClipboard() {\n    const [shareOption, setShareOption] = useState<string>('url');\n    const [copied, setCopied] = useState(false);\n\n    const handleCopyToClipboard = async (text: string) => {\n        try {\n            await navigator.clipboard.writeText(text);\n            setCopied(true);\n            toast.success('Copiado al portapapeles');\n\n            setTimeout(() => {\n                setCopied(false);\n            }, 2000);\n        } catch (error) {\n            console.error('Error al copiar:', error);\n            toast.error('No se pudo copiar al portapapeles');\n        }\n    };\n\n    return {\n        shareOption,\n        setShareOption,\n        copied,\n        handleCopyToClipboard\n    };\n}\n\n// Custom hook para impresión\nfunction usePrintWishlist() {\n    const printRef = useRef<HTMLDivElement>(null);\n\n    const handlePrint = () => {\n        window.print();\n    };\n\n    return {\n        printRef,\n        handlePrint\n    };\n}\n\n// Componentes Atómicos\nconst CardFullscreenViewer = React.memo(({\n    image,\n    name,\n    setName,\n    fullId,\n    rarity,\n    onClose\n}: {\n    image: string | null;\n    name: string;\n    setName: string;\n    fullId: string;\n    rarity: string;\n    onClose: () => void;\n}) => {\n    if (!image) return null;\n\n    return (\n        <div\n            className=\"fixed inset-0 z-50 bg-black/90 flex items-center justify-center p-4\"\n            onClick={onClose}\n        >\n            <div className=\"relative w-full max-w-4xl max-h-[90vh] flex flex-col items-center\">\n                <Button\n                    variant=\"ghost\"\n                    className=\"absolute top-0 right-0 text-white z-10 p-1 h-auto w-auto m-2 rounded-full bg-black/50 hover:bg-black/70\"\n                    onClick={onClose}\n                >\n                    <X size={24} />\n                </Button>\n\n                <div className=\"relative w-full h-auto max-h-[80vh] overflow-hidden flex items-center justify-center\">\n                    <img\n                        src={image}\n                        alt={name}\n                        className=\"object-contain max-h-[80vh] max-w-full rounded-lg\"\n                    />\n                </div>\n\n                <div className=\"text-white text-center mt-4 space-y-1\">\n                    <p className=\"font-medium text-xl\">{name}</p>\n                    <p className=\"text-sm text-gray-300\">\n                        <span className=\"capitalize\">{rarity}</span> •\n                        <span className=\"capitalize\"> {setName}</span>\n                        {fullId && <span> • ID: {fullId}</span>}\n                    </p>\n                </div>\n            </div>\n        </div>\n    );\n});\n\nCardFullscreenViewer.displayName = 'CardFullscreenViewer';\n\n// Componentes Moleculares\nconst ShareOptions = React.memo(({\n    shareOption,\n    onShareOptionChange,\n    onCopy,\n    copied,\n    onPrint\n}: {\n    shareOption: string;\n    onShareOptionChange: (value: string) => void;\n    onCopy: () => void;\n    copied: boolean;\n    onPrint: () => void;\n}) => {\n    return (\n        <div className=\"flex items-center gap-2\">\n            <Select value={shareOption} onValueChange={onShareOptionChange}>\n                <SelectTrigger className=\"w-36 sm:w-40 h-10\">\n                    <SelectValue placeholder=\"Compartir...\" />\n                </SelectTrigger>\n                <SelectContent>\n                    <SelectItem value=\"url\">URL completa</SelectItem>\n                    <SelectItem value=\"id\">Solo ID</SelectItem>\n                </SelectContent>\n            </Select>\n\n            <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={onCopy}\n                className=\"h-10 w-10\"\n            >\n                {copied ?\n                    <Check className=\"h-4 w-4 text-green-600\" /> :\n                    <Copy className=\"h-4 w-4\" />\n                }\n            </Button>\n\n            <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={onPrint}\n                className=\"h-10 w-10 print:hidden\"\n                title=\"Imprimir lista\"\n            >\n                <Printer className=\"h-4 w-4\" />\n            </Button>\n        </div>\n    );\n});\n\nShareOptions.displayName = 'ShareOptions';\n\nconst WishlistEditForm = React.memo(({\n    details,\n    onChange,\n    onSave,\n    onCancel\n}: {\n    details: { name: string; description: string };\n    onChange: (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => void;\n    onSave: () => void;\n    onCancel: () => void;\n}) => {\n    return (\n        <div className=\"space-y-4 border p-4 rounded-lg bg-white shadow-sm\">\n            <div>\n                <Label htmlFor=\"name\" className=\"text-base mb-1.5 block\">Nombre de la lista</Label>\n                <Input\n                    id=\"name\"\n                    name=\"name\"\n                    value={details.name}\n                    onChange={onChange}\n                    className=\"mt-1 h-11 text-base\"\n                />\n            </div>\n            <div>\n                <Label htmlFor=\"description\" className=\"text-base mb-1.5 block\">Descripción</Label>\n                <Textarea\n                    id=\"description\"\n                    name=\"description\"\n                    value={details.description}\n                    onChange={onChange}\n                    rows={3}\n                    className=\"mt-1 text-base\"\n                />\n            </div>\n            <div className=\"flex justify-end space-x-3 pt-2\">\n                <Button\n                    variant=\"outline\"\n                    size=\"lg\"\n                    onClick={onCancel}\n                    className=\"h-11\"\n                >\n                    Cancelar\n                </Button>\n                <Button\n                    size=\"lg\"\n                    onClick={onSave}\n                    className=\"h-11\"\n                >\n                    Guardar\n                </Button>\n            </div>\n        </div>\n    );\n});\n\nWishlistEditForm.displayName = 'WishlistEditForm';\n\nconst WishlistHeader = React.memo(({\n    wishlist,\n    isEditing,\n    details,\n    onDetailsChange,\n    onSaveDetails,\n    onCancelEdit,\n    onStartEdit,\n    onBack\n}: {\n    wishlist: WishList;\n    isEditing: boolean;\n    details: { name: string; description: string };\n    onDetailsChange: (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => void;\n    onSaveDetails: () => void;\n    onCancelEdit: () => void;\n    onStartEdit: () => void;\n    onBack: () => void;\n}) => {\n    return (\n        <div className=\"mb-6\">\n            <Button\n                variant=\"ghost\"\n                onClick={onBack}\n                className=\"mb-3 -ml-2 p-2 h-auto\"\n                size=\"lg\"\n            >\n                <ArrowLeft size={20} className=\"mr-2\" />\n                <span className=\"text-base\">Volver a mis listas</span>\n            </Button>\n\n            {isEditing ? (\n                <WishlistEditForm\n                    details={details}\n                    onChange={onDetailsChange}\n                    onSave={onSaveDetails}\n                    onCancel={onCancelEdit}\n                />\n            ) : (\n                <div className=\"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-3 bg-white p-4 rounded-lg shadow-sm\">\n                    <div>\n                        <h1 className=\"text-xl sm:text-2xl font-bold\">{wishlist.name}</h1>\n                        {wishlist.description && (\n                            <p className=\"text-muted-foreground mt-2 text-sm sm:text-base\">{wishlist.description}</p>\n                        )}\n                    </div>\n                    <div className=\"flex items-center gap-2 mt-1 sm:mt-0 self-end sm:self-auto\">\n                        <Button\n                            variant=\"outline\"\n                            size=\"lg\"\n                            onClick={onStartEdit}\n                            className=\"flex items-center gap-2 h-11\"\n                        >\n                            <Edit size={18} />\n                            <span className=\"inline text-base\">Editar</span>\n                        </Button>\n                    </div>\n                </div>\n            )}\n        </div>\n    );\n});\n\nWishlistHeader.displayName = 'WishlistHeader';\n\n// Componentes Organísmicos\nconst CardThumbnail = React.memo(({\n    card,\n    onOpenFullscreen,\n    onRemove\n}: {\n    card: EnrichedWishListCard;\n    onOpenFullscreen: (imageUrl: string | undefined, card: EnrichedWishListCard) => void;\n    onRemove: (cardId: string) => void;\n}) => {\n    const handleRemoveClick = (e: React.MouseEvent) => {\n        e.stopPropagation();\n        onRemove(card.wishlistData.cardId);\n    };\n\n    return (\n        <div className=\"flex flex-col bg-white shadow-sm rounded-lg overflow-hidden\">\n            <div\n                className=\"relative aspect-[3/4]\"\n                onClick={() => onOpenFullscreen(card.cardDetails.imageUrl, card)}\n            >\n                <Image\n                    src={card.cardDetails.imageUrl || '/placeholder-card.png'}\n                    alt={card.cardDetails.name}\n                    className=\"object-cover cursor-pointer\"\n                />\n\n                {/* Botón para eliminar */}\n                <div className=\"absolute top-1 right-1 z-20\">\n                    <div className=\"flex items-center justify-center h-8 w-8 rounded-full bg-red-600 shadow-lg border-2 border-white\">\n                        <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={handleRemoveClick}\n                            className=\"h-8 w-8 rounded-full text-white z-20 flex items-center justify-center hover:bg-red-700 transition-colors duration-150\"\n                            aria-label=\"Eliminar carta\"\n                        >\n                            <Trash size={20} className=\"text-white\" />\n                        </Button>\n                    </div>\n                </div>\n            </div>\n\n            <div className=\"p-1 text-center\">\n                <p className=\"text-xs font-medium truncate\">{card.cardDetails.name}</p>\n            </div>\n        </div>\n    );\n});\n\nCardThumbnail.displayName = 'CardThumbnail';\n\nconst CardGrid = React.memo(({\n    cards,\n    limit = Infinity,\n    onOpenFullscreen,\n    onRemoveCard\n}: {\n    cards: EnrichedWishListCard[];\n    limit?: number;\n    onOpenFullscreen: (imageUrl: string | undefined, card: EnrichedWishListCard) => void;\n    onRemoveCard: (cardId: string) => void;\n}) => {\n    const visibleCards = limit < Infinity ? cards.slice(0, limit) : cards;\n    const totalCards = cards.length;\n\n    return (\n        <div>\n            {limit < Infinity && totalCards > limit && (\n                <div className=\"mb-4\">\n                    <h2 className=\"text-xl font-medium\">\n                        Mostrando {limit} de {totalCards} cartas\n                    </h2>\n                </div>\n            )}\n\n            <div className=\"grid grid-cols-3 md:grid-cols-5 gap-2 md:gap-4\">\n                {visibleCards.map(card => (\n                    <CardThumbnail\n                        key={card.wishlistData.cardId}\n                        card={card}\n                        onOpenFullscreen={onOpenFullscreen}\n                        onRemove={onRemoveCard}\n                    />\n                ))}\n            </div>\n        </div>\n    );\n});\n\nCardGrid.displayName = 'CardGrid';\n\n// Componente para versión imprimible de las cartas\nconst PrintableWishlist = React.memo(({\n    wishlist,\n    cards\n}: {\n    wishlist: WishList;\n    cards: EnrichedWishListCard[];\n}) => {\n    return (\n        <div className=\"hidden print:block print:p-0\">\n            <div className=\"print:mb-4\">\n                <h1 className=\"text-2xl font-bold text-center\">{wishlist.name} - https://kodemcards.xyz/</h1>\n                {wishlist.description && (\n                    <p className=\"text-center text-muted-foreground mt-2\">{wishlist.description}</p>\n                )}\n            </div>\n\n            <div className=\"print:grid print:grid-cols-6 print:gap-2\">\n                {cards.map(card => (\n                    <div key={card.wishlistData.cardId} className=\"print:break-inside-avoid print:mb-2 print:flex print:flex-col print:items-center\">\n                        <div className=\"print:w-full print:aspect-[3/4] print:relative\">\n                            <img\n                                src={card.cardDetails.imageUrl || '/placeholder-card.png'}\n                                alt={card.cardDetails.name}\n                                className=\"print:object-contain print:h-full print:max-w-full\"\n                            />\n                        </div>\n                        <p className=\"print:text-xs print:mt-1 print:text-center print:font-medium\">{card.cardDetails.name}</p>\n                        <p className=\"print:text-xs print:mt-1 print:text-center print:font-medium\">{card.cardDetails.setName}</p>\n                        <p className=\"print:text-xs print:mt-1 print:text-center print:font-medium\">{card.cardDetails.fullId}</p>\n                    </div>\n                ))}\n            </div>\n        </div>\n    );\n});\n\nPrintableWishlist.displayName = 'PrintableWishlist';\n\n/**\n * WishlistDetail - Página de detalle de una lista de deseos\n * @returns Componente React\n */\nexport default function WishlistDetail() {\n    const [location, navigate] = useLocation();\n    const id = location.split('/').pop() || '';\n    const { user } = useAuth();\n\n    // Custom hooks\n    const {\n        isLoading,\n        cards,\n        selectedWishlist,\n        updateWishlist,\n        handleRemoveCard\n    } = useWishlistData(id);\n\n    const {\n        isEditingDetails,\n        setIsEditingDetails,\n        listDetails,\n        handleDetailsChange\n    } = useWishlistDetails(selectedWishlist);\n\n    const {\n        fullscreenImage,\n        fullscreenCardName,\n        fullscreenSetName,\n        fullscreenFullId,\n        fullscreenRarity,\n        handleOpenFullscreen,\n        handleCloseFullscreen\n    } = useFullscreenViewer();\n\n    const {\n        shareOption,\n        setShareOption,\n        copied,\n        handleCopyToClipboard\n    } = useClipboard();\n\n    const { handlePrint } = usePrintWishlist();\n\n    // Manejar navegación\n    const handleBack = () => navigate('/wishlists');\n\n    // Guardar cambios en detalles\n    const handleSaveDetails = async () => {\n        if (!selectedWishlist) return;\n\n        try {\n            await updateWishlist(selectedWishlist.id, {\n                name: listDetails.name,\n                description: listDetails.description\n            });\n            setIsEditingDetails(false);\n        } catch (error) {\n            console.error('Error al guardar los detalles:', error);\n        }\n    };\n\n    // Manejar cancelación de edición\n    const handleCancelEdit = () => {\n        if (selectedWishlist) {\n            setIsEditingDetails(false);\n        }\n    };\n\n    // Copiar URL o ID según opción seleccionada\n    const copyToClipboard = () => {\n        if (!selectedWishlist) return;\n\n        let textToCopy = window.location.href;\n\n        if (shareOption === 'id') {\n            textToCopy = id;\n        }\n\n        handleCopyToClipboard(textToCopy);\n    };\n\n    // Estado para scroll infinito\n    const [visibleCount, setVisibleCount] = useState(20);\n    const loaderRef = useRef<HTMLDivElement | null>(null);\n\n    // Resetear visibleCount cuando cambian las cartas\n    useEffect(() => {\n        setVisibleCount(20);\n    }, [cards]);\n\n    // Scroll infinito con IntersectionObserver\n    useEffect(() => {\n        if (!loaderRef.current) return;\n        const observer = new window.IntersectionObserver((entries) => {\n            if (entries[0].isIntersecting) {\n                setVisibleCount((prev) => Math.min(prev + 20, cards.length));\n            }\n        });\n        observer.observe(loaderRef.current);\n        return () => observer.disconnect();\n    }, [cards.length]);\n\n    // Si no hay usuario autenticado, mostrar mensaje\n    if (!user) {\n        return (\n            <EmptyState\n                title=\"Acceso no autorizado\"\n                description=\"Debes iniciar sesión para ver tus listas de deseos\"\n                icon=\"lock\"\n            />\n        );\n    }\n\n    // Si está cargando, mostrar spinner\n    if (isLoading) {\n        return (\n            <div className=\"flex justify-center items-center min-h-[60vh]\">\n                <Spinner size=\"lg\" />\n            </div>\n        );\n    }\n\n    // Si no hay lista seleccionada, mostrar mensaje de error\n    if (!selectedWishlist) {\n        return (\n            <EmptyState\n                title=\"Lista no encontrada\"\n                description=\"La lista que buscas no existe o no tienes acceso a ella\"\n                icon=\"error\"\n                action={\n                    <Button onClick={handleBack} variant=\"outline\" className=\"mt-4\">\n                        Volver a mis listas\n                    </Button>\n                }\n            />\n        );\n    }\n\n    return (\n        <div className=\"px-3 py-4 sm:container sm:px-4 sm:py-6 max-w-7xl mx-auto\">\n            {/* Estilos para impresión */}\n            <style dangerouslySetInnerHTML={{\n                __html: `\n                    @media print {\n                        body * {\n                            visibility: hidden;\n                        }\n                        .print\\\\:block, .print\\\\:block * {\n                            visibility: visible;\n                        }\n                        .print\\\\:block {\n                            position: absolute;\n                            left: 0;\n                            top: 0;\n                            width: 100%;\n                            padding: 15px;\n                        }\n                        @page {\n                            size: A4;\n                            margin: 10mm;\n                        }\n                    }\n                `\n            }} />\n\n            {/* Visualizador de imagen a pantalla completa */}\n            <CardFullscreenViewer\n                image={fullscreenImage}\n                name={fullscreenCardName}\n                setName={fullscreenSetName}\n                fullId={fullscreenFullId}\n                rarity={fullscreenRarity}\n                onClose={handleCloseFullscreen}\n            />\n\n            {/* Cabecera con opciones de compartir */}\n            <div className=\"flex justify-end items-center mb-3\">\n                <ShareOptions\n                    shareOption={shareOption}\n                    onShareOptionChange={setShareOption}\n                    onCopy={copyToClipboard}\n                    copied={copied}\n                    onPrint={handlePrint}\n                />\n            </div>\n\n            {/* Información de la wishlist con opciones de edición */}\n            <WishlistHeader\n                wishlist={selectedWishlist}\n                isEditing={isEditingDetails}\n                details={listDetails}\n                onDetailsChange={handleDetailsChange}\n                onSaveDetails={handleSaveDetails}\n                onCancelEdit={handleCancelEdit}\n                onStartEdit={() => setIsEditingDetails(true)}\n                onBack={handleBack}\n            />\n\n            {/* Contenido principal - Grid de cartas */}\n            {cards.length === 0 ? (\n                <EmptyState\n                    title=\"No hay cartas en esta lista\"\n                    description=\"Agrega cartas a esta lista desde la página de tu colección\"\n                    icon=\"heart\"\n                />\n            ) : (\n                <>\n                    {/* Vista móvil - Grid con 3 cartas por fila y scroll infinito */}\n                    <div className=\"md:hidden\">\n                        <div className=\"flex justify-between items-center mb-3\">\n                            <h2 className=\"text-lg font-medium\">{cards.length} {cards.length === 1 ? 'carta' : 'cartas'}</h2>\n                        </div>\n\n                        <CardGrid\n                            cards={cards.slice(0, visibleCount)}\n                            onOpenFullscreen={handleOpenFullscreen}\n                            onRemoveCard={handleRemoveCard}\n                        />\n                        {visibleCount < cards.length && (\n                            <div ref={loaderRef} className=\"h-8 flex items-center justify-center\">\n                                <Spinner size=\"sm\" />\n                                <span className=\"ml-2 text-xs text-muted-foreground\">Cargando más cartas...</span>\n                            </div>\n                        )}\n                    </div>\n\n                    {/* Vista desktop - Grid de cartas con scroll infinito */}\n                    <div className=\"hidden md:block\">\n                        <CardGrid\n                            cards={cards.slice(0, visibleCount)}\n                            onOpenFullscreen={handleOpenFullscreen}\n                            onRemoveCard={handleRemoveCard}\n                        />\n                        {visibleCount < cards.length && (\n                            <div ref={loaderRef} className=\"h-8 flex items-center justify-center\">\n                                <Spinner size=\"sm\" />\n                                <span className=\"ml-2 text-xs text-muted-foreground\">Cargando más cartas...</span>\n                            </div>\n                        )}\n                    </div>\n                </>\n            )}\n\n            {/* Versión imprimible de la wishlist */}\n            {selectedWishlist && cards.length > 0 && (\n                <PrintableWishlist\n                    wishlist={selectedWishlist}\n                    cards={cards}\n                />\n            )}\n        </div>\n    );\n}","usedDeprecatedRules":[]}]